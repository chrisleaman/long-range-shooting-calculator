<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Long Range Shooting Converter</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <h1>Long Range Shooting Converter</h1>
    <p class="subtitle">Measurement conversions and precision calculations</p>

    <!-- Tab navigation -->
    <div class="tab-container">
        <div class="tab-buttons">
            <button class="tab-btn active" onclick="switchTab('conversions', this)">Conversions</button>
            <button class="tab-btn" onclick="switchTab('energy', this)">Bullet Kinetic Energy</button>
            <button class="tab-btn" onclick="switchTab('topgun', this)">TOP Gun Precision</button>
            <button class="tab-btn" onclick="switchTab('samplesize', this)">Sample Size</button>
            <button class="tab-btn" onclick="switchTab('esanalysis', this)">Extreme Spread Analysis</button>
        </div>
    </div>

    <!-- Conversions Tab -->
    <div id="conversions-tab" class="tab-content active">

        <!-- MOA to MIL Converter -->
        <div class="converter-section">
            <h2>MOA ↔ MIL conversion</h2>
            <div class="input-group">
                <div class="input-field">
                    <label for="angular-value">Value</label>
                    <input type="number" id="angular-value" step="any" value="1" oninput="convertAngular()">
                </div>
                <div class="input-field">
                    <label for="angular-from">From</label>
                    <select id="angular-from" onchange="convertAngular()">
                        <option value="moa">MOA</option>
                        <option value="mil">MIL (mrad)</option>
                    </select>
                </div>
                <div class="input-field">
                    <label for="angular-to">To</label>
                    <select id="angular-to" onchange="convertAngular()">
                        <option value="mil">MIL (mrad)</option>
                        <option value="moa">MOA</option>
                    </select>
                </div>
                <button class="swap-btn" onclick="swapAngular()">↔ Swap</button>
            </div>
            <div class="result" id="angular-result">1 MOA = 0.2909 MIL</div>
            <div class="formula">1 MIL = 3.4377 MOA | 1 MOA = 0.2909 MIL</div>
        </div>

        <!-- Angular to Linear Converter -->
        <div class="converter-section">
            <h2>Angular to linear (MOA/MIL → inches/mm at distance)</h2>
            <div class="input-group">
                <div class="input-field">
                    <label for="ang-lin-value">Angular value</label>
                    <input type="number" id="ang-lin-value" step="any" value="1" oninput="convertAngularToLinear()">
                </div>
                <div class="input-field">
                    <label for="ang-lin-unit">Unit</label>
                    <select id="ang-lin-unit" onchange="convertAngularToLinear()">
                        <option value="moa">MOA</option>
                        <option value="mil">MIL (mrad)</option>
                    </select>
                </div>
                <div class="input-field">
                    <label for="ang-lin-distance">Distance</label>
                    <input type="number" id="ang-lin-distance" step="any" value="100" oninput="convertAngularToLinear()">
                </div>
                <div class="input-field">
                    <label for="ang-lin-dist-unit">Distance unit</label>
                    <select id="ang-lin-dist-unit" onchange="convertAngularToLinear()">
                        <option value="yards">Yards</option>
                        <option value="metres">Metres</option>
                    </select>
                </div>
            </div>
            <div class="result" id="ang-lin-result">
                1 MOA at 100 yards = <strong>1.047 inches</strong> / <strong>26.60 mm</strong>
            </div>
        </div>

        <!-- Linear to Angular Converter -->
        <div class="converter-section">
            <h2>Linear to angular (inches/mm → MOA/MIL at distance)</h2>
            <div class="input-group">
                <div class="input-field">
                    <label for="lin-ang-value">Linear value</label>
                    <input type="number" id="lin-ang-value" step="any" value="1" oninput="convertLinearToAngular()">
                </div>
                <div class="input-field">
                    <label for="lin-ang-unit">Unit</label>
                    <select id="lin-ang-unit" onchange="convertLinearToAngular()">
                        <option value="inches">Inches</option>
                        <option value="mm">Millimetres</option>
                    </select>
                </div>
                <div class="input-field">
                    <label for="lin-ang-distance">Distance</label>
                    <input type="number" id="lin-ang-distance" step="any" value="100" oninput="convertLinearToAngular()">
                </div>
                <div class="input-field">
                    <label for="lin-ang-dist-unit">Distance unit</label>
                    <select id="lin-ang-dist-unit" onchange="convertLinearToAngular()">
                        <option value="yards">Yards</option>
                        <option value="metres">Metres</option>
                    </select>
                </div>
            </div>
            <div class="result" id="lin-ang-result">
                1 inch at 100 yards = <strong>0.955 MOA</strong> / <strong>0.278 MIL</strong>
            </div>
        </div>

        <!-- Quick Reference -->
        <div class="constants">
            <h3>Reference constants</h3>
            <ul>
                <li><strong>1 MOA</strong> = 1.047 inches at 100 yards (true MOA)</li>
                <li><strong>1 MIL</strong> = 3.6 inches at 100 yards / 10 cm at 100 metres</li>
                <li><strong>1 MIL</strong> = 3.4377 MOA</li>
                <li><strong>1 inch</strong> = 25.4 mm</li>
                <li><strong>1 yard</strong> = 0.9144 metres</li>
            </ul>
        </div>
    </div>

    <!-- Bullet Kinetic Energy Tab -->
    <div id="energy-tab" class="tab-content">

        <div class="converter-section">
            <h2>Bullet kinetic energy calculator</h2>

            <div class="input-group">
                <div class="input-field">
                    <label for="bullet-weight">Bullet weight</label>
                    <input type="number" id="bullet-weight" step="any" value="150" oninput="calculateEnergy()">
                </div>
                <div class="input-field narrow">
                    <label for="weight-unit-energy">Unit</label>
                    <select id="weight-unit-energy" onchange="calculateEnergy()">
                        <option value="grains">Grains</option>
                        <option value="grams">Grams</option>
                    </select>
                </div>
                <div class="input-field">
                    <label for="muzzle-velocity">Muzzle velocity</label>
                    <input type="number" id="muzzle-velocity" step="any" value="2800" oninput="calculateEnergy()">
                </div>
                <div class="input-field narrow">
                    <label for="velocity-unit">Unit</label>
                    <select id="velocity-unit" onchange="calculateEnergy()">
                        <option value="fps">Feet/sec (fps)</option>
                        <option value="mps">Metres/sec (m/s)</option>
                    </select>
                </div>
            </div>

            <div class="result-box single">
                <h3>Kinetic energy</h3>
                <div class="value" id="energy-ftlbf">2,611 ft·lbf</div>
                <div class="secondary" id="energy-joules">3,541 J</div>
            </div>

            <div class="info-box tip">
                <h4>Using this with TOP Gun Precision</h4>
                <p>
                    The kinetic energy calculated here can be used directly as the "Bullet kinetic energy" input
                    in the <strong>TOP Gun Precision</strong> tab to estimate your rifle system's baseline precision.
                </p>
            </div>

            <div class="formula">
                Formula: E = (m × v²) / 450,437 where m is in grains and v is in fps
            </div>

            <!-- Typical Bullet Weights -->
            <div class="collapsible">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <span>Typical bullet weights by calibre</span>
                    <span class="arrow">▼</span>
                </div>
                <div class="collapsible-content">
                    <table class="ref-table">
                        <thead>
                            <tr>
                                <th>Calibre</th>
                                <th>Common weight(s)</th>
                                <th>Weight range</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="section-header">
                                <td colspan="3">Pistol</td>
                            </tr>
                            <tr>
                                <td>.22 LR</td>
                                <td>40 gr</td>
                                <td>30–40 gr</td>
                            </tr>
                            <tr>
                                <td>9mm Luger</td>
                                <td>115 gr, 124 gr</td>
                                <td>90–147+ gr</td>
                            </tr>
                            <tr>
                                <td>.40 S&W</td>
                                <td>165 gr, 180 gr</td>
                                <td>105–200 gr</td>
                            </tr>
                            <tr>
                                <td>.45 ACP</td>
                                <td>230 gr</td>
                                <td>68–300 gr</td>
                            </tr>
                            <tr class="section-header">
                                <td colspan="3">Rifle</td>
                            </tr>
                            <tr>
                                <td>.223 Rem / 5.56mm</td>
                                <td>55 gr, 62 gr</td>
                                <td>40–80+ gr</td>
                            </tr>
                            <tr>
                                <td>6.5 Creedmoor</td>
                                <td>140–150 gr</td>
                                <td>95–150 gr</td>
                            </tr>
                            <tr>
                                <td>.308 Win</td>
                                <td>150 gr, 165 gr, 180 gr</td>
                                <td>100–240 gr</td>
                            </tr>
                            <tr>
                                <td>.30-06 Sprg</td>
                                <td>150 gr, 165 gr, 180 gr</td>
                                <td>110–220 gr</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Typical Muzzle Velocities -->
            <div class="collapsible">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <span>Typical muzzle velocities by calibre</span>
                    <span class="arrow">▼</span>
                </div>
                <div class="collapsible-content">
                    <table class="ref-table">
                        <thead>
                            <tr>
                                <th>Calibre</th>
                                <th>Velocity (fps)</th>
                                <th>Velocity (m/s)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="section-header">
                                <td colspan="3">Pistol</td>
                            </tr>
                            <tr>
                                <td>.380 ACP</td>
                                <td>900–1,800 fps</td>
                                <td>~275–550 m/s</td>
                            </tr>
                            <tr>
                                <td>9mm</td>
                                <td>900–1,500 fps</td>
                                <td>~275–457 m/s</td>
                            </tr>
                            <tr>
                                <td>.45 ACP</td>
                                <td>750–1,300 fps</td>
                                <td>~230–396 m/s</td>
                            </tr>
                            <tr class="section-header">
                                <td colspan="3">Rifle</td>
                            </tr>
                            <tr>
                                <td>.22 LR</td>
                                <td>1,200–1,800 fps</td>
                                <td>~366–550 m/s</td>
                            </tr>
                            <tr>
                                <td>.223 / 5.56</td>
                                <td>2,500–4,000 fps</td>
                                <td>~762–1,219 m/s</td>
                            </tr>
                            <tr>
                                <td>6.5 Creedmoor</td>
                                <td>2,500–3,000 fps</td>
                                <td>~762–914 m/s</td>
                            </tr>
                            <tr>
                                <td>.308 Win</td>
                                <td>2,500–3,500 fps</td>
                                <td>~762–1,067 m/s</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- TOP Gun Precision Tab -->
    <div id="topgun-tab" class="tab-content">

        <div class="converter-section">
            <h2>TOP Gun precision calculator</h2>

            <div class="input-group">
                <div class="input-field">
                    <label for="bullet-energy">Bullet kinetic energy</label>
                    <input type="number" id="bullet-energy" step="any" value="2400" oninput="calculateTOPGun()">
                </div>
                <div class="input-field narrow">
                    <label for="energy-unit">Unit</label>
                    <select id="energy-unit" onchange="calculateTOPGun()">
                        <option value="ftlbf">ft·lbf</option>
                        <option value="joules">Joules</option>
                    </select>
                </div>
                <div class="input-field">
                    <label for="rifle-weight">Rifle weight</label>
                    <input type="number" id="rifle-weight" step="any" value="10" oninput="calculateTOPGun()">
                </div>
                <div class="input-field narrow">
                    <label for="rifle-weight-unit">Unit</label>
                    <select id="rifle-weight-unit" onchange="calculateTOPGun()">
                        <option value="lbs">Pounds (lbs)</option>
                        <option value="kg">Kilograms (kg)</option>
                    </select>
                </div>
            </div>

            <div class="result-grid">
                <div class="result-box">
                    <h3>Precision (avg 5-shot extreme spread)</h3>
                    <div class="value" id="precision-moa">1.200 MOA</div>
                    <div class="secondary" id="precision-mil">0.349 MIL</div>
                </div>
                <div class="result-box">
                    <h3>Mean radius</h3>
                    <div class="value" id="mean-radius-in">0.514 inches</div>
                    <div class="secondary" id="mean-radius-mm">13.05 mm</div>
                </div>
            </div>

            <div class="info-box">
                <h4>About this calculation</h4>
                <p>
                    <strong>Precision (MOA)</strong> is calculated using the Applied Ballistics "TOP Gun" formula:
                    <em>Bullet Energy (ft·lbf) ÷ 200 ÷ Rifle Weight (lbs)</em>.
                    This estimates the average 5-shot extreme spread at 100 yards for a given rifle system. [2]
                </p>
                <p style="margin-top: 10px;">
                    <strong>Mean radius</strong> represents the average distance of each shot from the centre of the group.
                    Unlike extreme spread (which only measures the two worst shots), mean radius accounts for every shot
                    in the group, making it more statistically meaningful—especially for smaller sample sizes. [2]
                    The conversion uses a coefficient of 0.428 derived from simulation of approximately 1 million 5-shot groups. [2]
                </p>
                <p style="margin-top: 10px;">
                    <a href="https://www.reddit.com/r/longrange/comments/1nfq1ms/top_gun_modified_to_output_mean_radius_and_back/" target="_blank">See this Reddit post for further details on the mean radius derivation →</a>
                </p>
            </div>

            <!-- Typical Energy Values -->
            <div class="collapsible">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <span>Typical bullet kinetic energy values</span>
                    <span class="arrow">▼</span>
                </div>
                <div class="collapsible-content">
                    <table class="ref-table">
                        <thead>
                            <tr>
                                <th>Cartridge</th>
                                <th>Muzzle energy (Joules)</th>
                                <th>Muzzle energy (ft·lbf)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>9mm Parabellum</td>
                                <td>~480 – 700 J</td>
                                <td>~350 – 500 ft·lbf</td>
                            </tr>
                            <tr>
                                <td>5.56 NATO (rifle)</td>
                                <td>~1,700 – 1,800 J</td>
                                <td>~1,250 – 1,330 ft·lbf</td>
                            </tr>
                            <tr>
                                <td>.308 Winchester (rifle)</td>
                                <td>~3,300 J</td>
                                <td>~2,400 ft·lbf</td>
                            </tr>
                            <tr>
                                <td>.30-06 Springfield (rifle)</td>
                                <td>~3,000 – 4,000 J</td>
                                <td>~2,000 – 3,000 ft·lbf</td>
                            </tr>
                            <tr>
                                <td>.50 BMG (anti-materiel)</td>
                                <td>~14,000 – 20,000 J</td>
                                <td>~10,000 – 15,000 ft·lbf</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Typical Rifle Weights -->
            <div class="collapsible">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <span>Typical rifle weight ranges</span>
                    <span class="arrow">▼</span>
                </div>
                <div class="collapsible-content">
                    <table class="ref-table">
                        <thead>
                            <tr>
                                <th>Application</th>
                                <th>Weight range (lbs)</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Lightweight/Backcountry hunting</td>
                                <td>5 – 8 lbs</td>
                                <td>Prioritises portability over long distances</td>
                            </tr>
                            <tr>
                                <td>General hunting</td>
                                <td>6 – 12 lbs</td>
                                <td>Balance between portability and stability</td>
                            </tr>
                            <tr>
                                <td>Tactical/Defence (M4, AR-15)</td>
                                <td>6.5 – 10 lbs</td>
                                <td>Robustness, reliability, manoeuvrability</td>
                            </tr>
                            <tr>
                                <td>Varmint shooting</td>
                                <td>7 – 10 lbs</td>
                                <td>Compromise for long-range precision</td>
                            </tr>
                            <tr>
                                <td>Target/Competition (PRS, Benchrest)</td>
                                <td>10 – 25+ lbs</td>
                                <td>Maximises stability, minimises recoil</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Sample Size Tab -->
    <div id="samplesize-tab" class="tab-content">

        <div class="converter-section">
            <h2>Minimum sample size calculator</h2>
            <p style="margin-top: 0; color: #666; font-size: 0.9rem;">
                Calculate the minimum number of shots per group to statistically determine a difference between two loads with >95% confidence.
            </p>

            <div class="input-group">
                <div class="input-field">
                    <label for="load1-radius">Load #1 mean radius</label>
                    <input type="number" id="load1-radius" step="0.001" value="0.200" min="0.001" oninput="calculateSampleSize()">
                </div>
                <div class="input-field">
                    <label for="load2-radius">Load #2 mean radius</label>
                    <input type="number" id="load2-radius" step="0.001" value="0.300" min="0.001" oninput="calculateSampleSize()">
                </div>
                <div class="input-field narrow">
                    <label for="radius-unit">Unit</label>
                    <select id="radius-unit" onchange="onRadiusUnitChange()">
                        <option value="inches">Inches</option>
                        <option value="mm">Millimetres</option>
                    </select>
                </div>
            </div>

            <div class="result-box single" id="sample-size-result">
                <h3>Minimum shots per group</h3>
                <div class="value" id="min-shots">22</div>
                <div class="secondary" id="sample-size-note">in EACH group to have >95% confidence the loads are different</div>
            </div>

            <div class="info-box">
                <h4>About this calculation</h4>
                <p>
                    This calculator is based on the work of <strong>Chris Hague at Hague & Sons Precision Gunsmithing</strong>.
                    It determines the minimum sample size needed to statistically differentiate between two loads
                    at a 95% confidence level.
                </p>
                <p style="margin-top: 10px;">
                    The formula used is:
                </p>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 4px; margin: 10px 0; text-align: center; font-family: 'Times New Roman', serif; font-size: 1.2rem;">
                    <em>n</em><sub>min</sub> = ⌈(0.730 × (R<sub>2</sub> + R<sub>1</sub>) / (R<sub>2</sub> − R<sub>1</sub>))<sup>2</sup>⌉ , <em>n</em><sub>min</sub> ≥ 10
                </div>
                <p style="margin-top: 10px;">
                    Where R<sub>1</sub> and R<sub>2</sub> are the mean radii of Load #1 and Load #2 respectively, and the result
                    is rounded up (ceiling function). A minimum of 10 shots is always required regardless of the calculation.
                </p>
                <p style="margin-top: 10px;">
                    <strong>Interpretation:</strong> If the loads truly differ by the amounts you entered, shooting this many rounds
                    per group gives you at least 95% confidence that any observed difference is real, not random chance.
                </p>
            </div>

            <!-- Reference table -->
            <div class="collapsible">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <span>Full reference table</span>
                    <span class="arrow">▼</span>
                </div>
                <div class="collapsible-content">
                    <p style="font-size: 0.85rem; color: #666; margin-bottom: 10px;">
                        Minimum number of shots in EACH group to have >95% confidence the loads are different
                    </p>
                    <div style="overflow-x: auto;">
                        <table class="sample-size-table" id="sample-size-table">
                            <!-- Table generated by JavaScript -->
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Extreme Spread Analysis Tab -->
    <div id="esanalysis-tab" class="tab-content">

        <div class="converter-section">
            <h2>Extreme spread to mean radius analysis</h2>
            <p style="margin-top: 0; color: #666; font-size: 0.9rem;">
                Convert your observed extreme spread (ES) to an estimated mean radius (MR) distribution based on Monte Carlo simulation of 1,000,000 shot groups.
            </p>

            <div class="warning-box" id="es-warning">
                The lookup table covers ES values from 0.1 to 2.0 MOA. Values outside this range cannot be calculated.
            </div>

            <div class="input-group">
                <div class="input-field">
                    <label for="es-value">Observed extreme spread</label>
                    <input type="number" id="es-value" step="any" value="1" min="0" oninput="calculateEStoMR()">
                </div>
                <div class="input-field narrow">
                    <label for="es-unit">Unit</label>
                    <select id="es-unit" onchange="onESUnitChange()">
                        <option value="moa">MOA</option>
                        <option value="mil">MIL (mrad)</option>
                        <option value="inches">Inches</option>
                        <option value="mm">Millimetres</option>
                    </select>
                </div>
                <div class="input-field distance-group" id="es-distance-group">
                    <label for="es-distance">Distance</label>
                    <input type="number" id="es-distance" step="any" value="100" min="1" oninput="calculateEStoMR()">
                </div>
                <div class="input-field narrow distance-group" id="es-distance-unit-group">
                    <label for="es-distance-unit">Distance unit</label>
                    <select id="es-distance-unit" onchange="calculateEStoMR()">
                        <option value="yards">Yards</option>
                        <option value="metres">Metres</option>
                    </select>
                </div>
                <div class="input-field narrow">
                    <label for="es-shots">Shots in group</label>
                    <select id="es-shots" onchange="calculateEStoMR()">
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5" selected>5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                        <option value="15">15</option>
                        <option value="16">16</option>
                        <option value="17">17</option>
                        <option value="18">18</option>
                        <option value="19">19</option>
                        <option value="20">20</option>
                        <option value="21">21</option>
                        <option value="22">22</option>
                        <option value="23">23</option>
                        <option value="24">24</option>
                        <option value="25">25</option>
                    </select>
                </div>
            </div>

            <!-- Bell Curve Visualization -->
            <div class="bell-curve-container">
                <svg class="bell-curve-svg" viewBox="0 0 400 180" id="bell-curve-svg">
                    <!-- Bell curve path -->
                    <defs>
                        <linearGradient id="bellGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#e8f4e8;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#d4edda;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <!-- Axes -->
                    <line x1="40" y1="140" x2="360" y2="140" stroke="#ccc" stroke-width="1"/>
                    <!-- Bell curve filled -->
                    <path id="bell-curve-path" fill="url(#bellGradient)" stroke="#28a745" stroke-width="2"/>
                    <!-- Percentile markers -->
                    <line id="marker-p5" x1="100" y1="20" x2="100" y2="140" stroke="#28a745" stroke-width="2" stroke-dasharray="4,2"/>
                    <line id="marker-p50" x1="200" y1="20" x2="200" y2="140" stroke="#007bff" stroke-width="2"/>
                    <line id="marker-p95" x1="300" y1="20" x2="300" y2="140" stroke="#dc3545" stroke-width="2" stroke-dasharray="4,2"/>
                    <!-- Labels on curve -->
                    <text id="label-p5" x="100" y="155" text-anchor="middle" font-size="11" fill="#28a745">5%</text>
                    <text id="label-p50" x="200" y="155" text-anchor="middle" font-size="11" fill="#007bff">50%</text>
                    <text id="label-p95" x="300" y="155" text-anchor="middle" font-size="11" fill="#dc3545">95%</text>
                    <!-- Axis label -->
                    <text x="200" y="175" text-anchor="middle" font-size="11" fill="#666">Mean Radius (MOA)</text>
                </svg>
                <div class="bell-curve-labels">
                    <div class="bell-curve-label p5">
                        <div class="percentile">5th percentile (optimistic)</div>
                        <div class="value" id="mr-p5-value">0.291 MOA</div>
                    </div>
                    <div class="bell-curve-label p50">
                        <div class="percentile">50th percentile (typical)</div>
                        <div class="value" id="mr-p50-value">0.369 MOA</div>
                    </div>
                    <div class="bell-curve-label p95">
                        <div class="percentile">95th percentile (conservative)</div>
                        <div class="value" id="mr-p95-value">0.451 MOA</div>
                    </div>
                </div>
            </div>

            <!-- Result boxes with converted units -->
            <div class="result-grid" id="es-mr-results">
                <div class="result-box">
                    <h3>Typical mean radius (50th percentile)</h3>
                    <div class="value" id="mr-typical-moa">0.369 MOA</div>
                    <div class="secondary" id="mr-typical-secondary">0.107 MIL / 0.387 in @ 100 yd</div>
                </div>
                <div class="result-box">
                    <h3>Range (5th to 95th percentile)</h3>
                    <div class="value" id="mr-range">0.291 – 0.451 MOA</div>
                    <div class="secondary" id="mr-range-secondary">0.305 – 0.472 in @ 100 yd</div>
                </div>
            </div>

            <!-- BPC Comparison Section -->
            <div class="bpc-section">
                <h3>Ballistic Precision Classification (BPC) Comparison</h3>
                <p style="margin: 0 0 15px 0; color: #666; font-size: 0.9rem;">
                    Compare your rifle's precision against standard BPC classes. Based on your observed extreme spread,
                    we estimate the underlying sigma (σ) and compare it to each class threshold.
                </p>
                <table class="bpc-table" id="bpc-table">
                    <thead>
                        <tr>
                            <th>BPC Class</th>
                            <th>Sigma (σ)</th>
                            <th>Median 5-shot Group Spread</th>
                            <th>Typical Examples</th>
                            <th>Your Results</th>
                        </tr>
                    </thead>
                    <tbody id="bpc-table-body">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
                <div class="info-box" style="margin-top: 0;">
                    <h4>About BPC</h4>
                    <p>
                        <strong>Ballistic Precision Classification (BPC)</strong> is a standardised system for describing rifle precision.
                        It uses sigma (σ), the statistical parameter of the Rayleigh distribution, to characterise accuracy.
                        Lower BPC classes indicate better precision.
                    </p>
                    <p style="margin-top: 10px;">
                        <strong>Your Results</strong> interpretation:
                    </p>
                    <ul style="margin: 5px 0 0 20px; padding: 0;">
                        <li><strong style="color: #155724;">Yes:</strong> Your rifle is more accurate than this class (95% confidence)</li>
                        <li><strong style="color: #856404;">Plausible:</strong> Your results are consistent with this class</li>
                        <li><strong style="color: #721c24;">No:</strong> Your rifle is less accurate than this class (95% confidence)</li>
                    </ul>
                    <p style="margin-top: 10px;">
                        <a href="http://ballistipedia.com/index.php?title=Ballistic_Precision_Classification" target="_blank">Learn more about BPC on Ballistipedia →</a>
                    </p>
                </div>
            </div>

            <div class="info-box">
                <h4>About this calculation</h4>
                <p>
                    <strong>Extreme Spread (ES)</strong> measures the maximum distance between any two shots in a group.
                    <strong>Mean Radius (MR)</strong> measures the average distance of each shot from the group centre.
                </p>
                <p style="margin-top: 10px;">
                    Because ES only considers the two most extreme shots, it's highly variable—especially with small sample sizes.
                    Mean radius accounts for every shot, making it more statistically stable and meaningful for comparing precision.
                </p>
                <p style="margin-top: 10px;">
                    This calculator uses Monte Carlo simulation (1,000,000 groups per sample size) to estimate the distribution
                    of mean radius values you might observe for a given extreme spread. The percentiles represent:
                </p>
                <ul style="margin: 10px 0 0 20px; padding: 0;">
                    <li><strong>5th percentile:</strong> Optimistic estimate—only 5% of groups would have a smaller MR</li>
                    <li><strong>50th percentile:</strong> Typical/median estimate—half of groups would be better, half worse</li>
                    <li><strong>95th percentile:</strong> Conservative estimate—95% of groups would have a smaller MR</li>
                </ul>
                <p style="margin-top: 10px;">
                    <a href="http://ballistipedia.com/index.php?title=Precision_Models" target="_blank">Learn more about precision models on Ballistipedia →</a>
                </p>
            </div>

            <!-- Reference table -->
            <div class="collapsible">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <span>Full reference table</span>
                    <span class="arrow">▼</span>
                </div>
                <div class="collapsible-content">
                    <p style="font-size: 0.85rem; color: #666; margin-bottom: 10px;">
                        Mean radius values (MOA) for each extreme spread and shot count combination.
                    </p>
                    <div class="percentile-selector">
                        <label>
                            <input type="radio" name="es-percentile" value="0" onchange="generateEStoMRTable()">
                            5th percentile (optimistic)
                        </label>
                        <label>
                            <input type="radio" name="es-percentile" value="1" checked onchange="generateEStoMRTable()">
                            50th percentile (typical)
                        </label>
                        <label>
                            <input type="radio" name="es-percentile" value="2" onchange="generateEStoMRTable()">
                            95th percentile (conservative)
                        </label>
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="es-mr-table" id="es-mr-table">
                            <!-- Table generated by JavaScript -->
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts: data and constants first, then UI infrastructure, then per-tab logic -->
    <script src="js/es-mr-data.js"></script>
    <script src="js/constants.js"></script>
    <script src="js/tabs.js"></script>
    <script src="js/conversions.js"></script>
    <script src="js/energy.js"></script>
    <script src="js/topgun.js"></script>
    <script src="js/samplesize.js"></script>
    <script src="js/esanalysis.js"></script>
</body>
</html>
