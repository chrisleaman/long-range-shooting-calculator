<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Long Range Shooting Converter</title>
    <style>
        * {
            box-sizing: border-box;
        }

        html {
            overflow-y: scroll; /* Fallback for older browsers */
            scrollbar-gutter: stable; /* Modern approach - reserves space without always showing scrollbar */
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
            color: #333;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
        }
        
        /* Tab styles */
        .tab-container {
            margin-bottom: 20px;
        }
        
        .tab-buttons {
            display: flex;
            gap: 4px;
            border-bottom: 2px solid #ddd;
            padding-bottom: 0;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 12px 20px;
            border: none;
            background: #e0e0e0;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            border-radius: 8px 8px 0 0;
            transition: background 0.2s, color 0.2s;
            position: relative;
            bottom: -2px;
        }
        
        .tab-btn:hover {
            background: #d0d0d0;
        }
        
        .tab-btn.active {
            background: white;
            border: 2px solid #ddd;
            border-bottom: 2px solid white;
            color: #007bff;
        }
        
        .tab-content {
            display: none;
            padding-top: 20px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .converter-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .converter-section h2 {
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
            font-size: 1.1rem;
        }
        
        .input-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: flex-end;
            margin-bottom: 15px;
        }
        
        .input-field {
            flex: 1;
            min-width: 120px;
        }
        
        .input-field.narrow {
            flex: 0.7;
            min-width: 100px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        input[type="number"], select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        input[type="number"]:focus, select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }
        
        .result {
            background: #e8f4e8;
            padding: 15px;
            border-radius: 4px;
            font-size: 1.1rem;
            text-align: center;
        }
        
        .result strong {
            color: #2d6a2d;
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .result-box {
            background: #e8f4e8;
            padding: 15px;
            border-radius: 4px;
            text-align: center;
        }
        
        .result-box.single {
            grid-column: 1 / -1;
        }
        
        .result-box h3 {
            margin: 0 0 10px 0;
            font-size: 0.9rem;
            color: #555;
        }
        
        .result-box .value {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2d6a2d;
        }
        
        .result-box .secondary {
            font-size: 0.95rem;
            color: #444;
            margin-top: 5px;
        }
        
        .formula {
            font-size: 0.85rem;
            color: #666;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }
        
        .info-box {
            background: #f0f7ff;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin-top: 15px;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .info-box h4 {
            margin: 0 0 8px 0;
            color: #0056b3;
        }
        
        .info-box a {
            color: #007bff;
            text-decoration: none;
        }
        
        .info-box a:hover {
            text-decoration: underline;
        }
        
        .info-box.tip {
            background: #fff8e6;
            border-left-color: #f0a500;
        }
        
        .info-box.tip h4 {
            color: #c28400;
        }
        
        .constants {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            font-size: 0.85rem;
            margin-top: 20px;
        }
        
        .constants h3 {
            margin-top: 0;
            font-size: 0.95rem;
        }
        
        .constants ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .constants li {
            margin-bottom: 5px;
        }
        
        .swap-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .swap-btn:hover {
            background: #0056b3;
        }
        
        /* Collapsible sections */
        .collapsible {
            margin-top: 15px;
        }
        
        .collapsible-header {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
            font-size: 0.95rem;
        }
        
        .collapsible-header:hover {
            background: #eee;
        }
        
        .collapsible-header .arrow {
            transition: transform 0.2s;
        }
        
        .collapsible-header.open .arrow {
            transform: rotate(180deg);
        }
        
        .collapsible-content {
            display: none;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 4px 4px;
            padding: 15px;
            background: white;
            overflow-x: auto;
        }
        
        .collapsible-content.open {
            display: block;
        }
        
        /* Reference tables */
        .ref-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
            margin-top: 10px;
        }
        
        .ref-table th, .ref-table td {
            padding: 8px 10px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .ref-table th {
            background: #f5f5f5;
            font-weight: 600;
        }
        
        .ref-table tr:last-child td {
            border-bottom: none;
        }
        
        .ref-table .section-header {
            background: #e8e8e8;
            font-weight: 600;
        }
        
        /* Sample size table */
        .sample-size-table {
            border-collapse: collapse;
            font-size: 0.75rem;
            width: auto;
        }

        .sample-size-table th,
        .sample-size-table td {
            border: 1px solid #ddd;
            padding: 4px 6px;
            text-align: center;
            min-width: 36px;
        }

        .sample-size-table th {
            background: #f5f5f5;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .sample-size-table .row-header {
            background: #f5f5f5;
            font-weight: 600;
            position: sticky;
            left: 0;
        }

        .sample-size-table .corner-header {
            background: #e8e8e8;
            position: sticky;
            top: 0;
            left: 0;
            z-index: 2;
        }

        .sample-size-table .diagonal {
            background: #d4d4d4;
            color: #888;
        }

        .sample-size-table .low {
            background: #d4edda;
        }

        .sample-size-table .medium {
            background: #f8d7da;
        }

        .sample-size-table .high {
            background: #c94c4c;
            color: white;
        }

        /* ES to MR table (reuses sample-size-table styles) */
        .es-mr-table {
            border-collapse: collapse;
            font-size: 0.75rem;
            width: auto;
        }

        .es-mr-table th,
        .es-mr-table td {
            border: 1px solid #ddd;
            padding: 4px 6px;
            text-align: center;
            min-width: 36px;
        }

        .es-mr-table th {
            background: #f5f5f5;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .es-mr-table .row-header {
            background: #f5f5f5;
            font-weight: 600;
            position: sticky;
            left: 0;
        }

        .es-mr-table .corner-header {
            background: #e8e8e8;
            position: sticky;
            top: 0;
            left: 0;
            z-index: 2;
        }

        /* Bell curve styles */
        .bell-curve-container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .bell-curve-svg {
            width: 100%;
            max-width: 500px;
            height: auto;
            display: block;
            margin: 0 auto;
        }

        .bell-curve-labels {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
            font-size: 0.85rem;
        }

        .bell-curve-label {
            text-align: center;
        }

        .bell-curve-label .percentile {
            font-weight: 600;
            color: #555;
        }

        .bell-curve-label .value {
            font-size: 1rem;
            font-weight: 600;
        }

        .bell-curve-label.p5 .value { color: #28a745; }
        .bell-curve-label.p50 .value { color: #007bff; }
        .bell-curve-label.p95 .value { color: #dc3545; }

        /* Percentile selector */
        .percentile-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .percentile-selector label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            font-weight: normal;
        }

        .percentile-selector input[type="radio"] {
            width: auto;
            margin: 0;
        }

        /* Warning box */
        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 12px 15px;
            margin-bottom: 15px;
            font-size: 0.9rem;
            display: none;
        }

        .warning-box.visible {
            display: block;
        }

        /* Distance input group (show/hide based on unit) */
        .distance-group {
            display: none;
        }

        .distance-group.visible {
            display: block;
        }

        /* BPC comparison table */
        .bpc-section {
            margin-top: 20px;
        }

        .bpc-section h3 {
            margin: 0 0 10px 0;
            font-size: 1rem;
            color: #333;
        }

        .bpc-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .bpc-table th,
        .bpc-table td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .bpc-table th {
            background: #f5f5f5;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .bpc-table td:last-child {
            text-align: center;
            font-weight: 600;
        }

        .bpc-table .bpc-yes {
            background: #d4edda;
            color: #155724;
        }

        .bpc-table .bpc-no {
            background: #f8d7da;
            color: #721c24;
        }

        .bpc-table .bpc-plausible {
            background: #fff3cd;
            color: #856404;
        }

        .bpc-table .bpc-unknown {
            background: #e9ecef;
            color: #6c757d;
        }

        .bpc-table .example-col {
            font-size: 0.85rem;
            color: #666;
        }

        @media (max-width: 600px) {
            .input-field {
                min-width: 100%;
            }
            
            .input-field.narrow {
                min-width: 100%;
            }
            
            .result-grid {
                grid-template-columns: 1fr;
            }
            
            .tab-btn {
                padding: 10px 14px;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <h1>Long Range Shooting Converter</h1>
    <p class="subtitle">Measurement conversions and precision calculations</p>

    <!-- Tab navigation -->
    <div class="tab-container">
        <div class="tab-buttons">
            <button class="tab-btn active" onclick="switchTab('conversions', this)">Conversions</button>
            <button class="tab-btn" onclick="switchTab('energy', this)">Bullet Kinetic Energy</button>
            <button class="tab-btn" onclick="switchTab('topgun', this)">TOP Gun Precision</button>
            <button class="tab-btn" onclick="switchTab('samplesize', this)">Sample Size</button>
            <button class="tab-btn" onclick="switchTab('esanalysis', this)">Extreme Spread Analysis</button>
        </div>
    </div>

    <!-- Conversions Tab -->
    <div id="conversions-tab" class="tab-content active">
        
        <!-- MOA to MIL Converter -->
        <div class="converter-section">
            <h2>MOA ↔ MIL conversion</h2>
            <div class="input-group">
                <div class="input-field">
                    <label for="angular-value">Value</label>
                    <input type="number" id="angular-value" step="any" value="1" oninput="convertAngular()">
                </div>
                <div class="input-field">
                    <label for="angular-from">From</label>
                    <select id="angular-from" onchange="convertAngular()">
                        <option value="moa">MOA</option>
                        <option value="mil">MIL (mrad)</option>
                    </select>
                </div>
                <div class="input-field">
                    <label for="angular-to">To</label>
                    <select id="angular-to" onchange="convertAngular()">
                        <option value="mil">MIL (mrad)</option>
                        <option value="moa">MOA</option>
                    </select>
                </div>
                <button class="swap-btn" onclick="swapAngular()">↔ Swap</button>
            </div>
            <div class="result" id="angular-result">1 MOA = 0.2909 MIL</div>
            <div class="formula">1 MIL = 3.4377 MOA | 1 MOA = 0.2909 MIL</div>
        </div>

        <!-- Angular to Linear Converter -->
        <div class="converter-section">
            <h2>Angular to linear (MOA/MIL → inches/mm at distance)</h2>
            <div class="input-group">
                <div class="input-field">
                    <label for="ang-lin-value">Angular value</label>
                    <input type="number" id="ang-lin-value" step="any" value="1" oninput="convertAngularToLinear()">
                </div>
                <div class="input-field">
                    <label for="ang-lin-unit">Unit</label>
                    <select id="ang-lin-unit" onchange="convertAngularToLinear()">
                        <option value="moa">MOA</option>
                        <option value="mil">MIL (mrad)</option>
                    </select>
                </div>
                <div class="input-field">
                    <label for="ang-lin-distance">Distance</label>
                    <input type="number" id="ang-lin-distance" step="any" value="100" oninput="convertAngularToLinear()">
                </div>
                <div class="input-field">
                    <label for="ang-lin-dist-unit">Distance unit</label>
                    <select id="ang-lin-dist-unit" onchange="convertAngularToLinear()">
                        <option value="yards">Yards</option>
                        <option value="metres">Metres</option>
                    </select>
                </div>
            </div>
            <div class="result" id="ang-lin-result">
                1 MOA at 100 yards = <strong>1.047 inches</strong> / <strong>26.60 mm</strong>
            </div>
        </div>

        <!-- Linear to Angular Converter -->
        <div class="converter-section">
            <h2>Linear to angular (inches/mm → MOA/MIL at distance)</h2>
            <div class="input-group">
                <div class="input-field">
                    <label for="lin-ang-value">Linear value</label>
                    <input type="number" id="lin-ang-value" step="any" value="1" oninput="convertLinearToAngular()">
                </div>
                <div class="input-field">
                    <label for="lin-ang-unit">Unit</label>
                    <select id="lin-ang-unit" onchange="convertLinearToAngular()">
                        <option value="inches">Inches</option>
                        <option value="mm">Millimetres</option>
                    </select>
                </div>
                <div class="input-field">
                    <label for="lin-ang-distance">Distance</label>
                    <input type="number" id="lin-ang-distance" step="any" value="100" oninput="convertLinearToAngular()">
                </div>
                <div class="input-field">
                    <label for="lin-ang-dist-unit">Distance unit</label>
                    <select id="lin-ang-dist-unit" onchange="convertLinearToAngular()">
                        <option value="yards">Yards</option>
                        <option value="metres">Metres</option>
                    </select>
                </div>
            </div>
            <div class="result" id="lin-ang-result">
                1 inch at 100 yards = <strong>0.955 MOA</strong> / <strong>0.278 MIL</strong>
            </div>
        </div>

        <!-- Quick Reference -->
        <div class="constants">
            <h3>Reference constants</h3>
            <ul>
                <li><strong>1 MOA</strong> = 1.047 inches at 100 yards (true MOA)</li>
                <li><strong>1 MIL</strong> = 3.6 inches at 100 yards / 10 cm at 100 metres</li>
                <li><strong>1 MIL</strong> = 3.4377 MOA</li>
                <li><strong>1 inch</strong> = 25.4 mm</li>
                <li><strong>1 yard</strong> = 0.9144 metres</li>
            </ul>
        </div>
    </div>

    <!-- Bullet Kinetic Energy Tab -->
    <div id="energy-tab" class="tab-content">
        
        <div class="converter-section">
            <h2>Bullet kinetic energy calculator</h2>
            
            <div class="input-group">
                <div class="input-field">
                    <label for="bullet-weight">Bullet weight</label>
                    <input type="number" id="bullet-weight" step="any" value="150" oninput="calculateEnergy()">
                </div>
                <div class="input-field narrow">
                    <label for="weight-unit-energy">Unit</label>
                    <select id="weight-unit-energy" onchange="calculateEnergy()">
                        <option value="grains">Grains</option>
                        <option value="grams">Grams</option>
                    </select>
                </div>
                <div class="input-field">
                    <label for="muzzle-velocity">Muzzle velocity</label>
                    <input type="number" id="muzzle-velocity" step="any" value="2800" oninput="calculateEnergy()">
                </div>
                <div class="input-field narrow">
                    <label for="velocity-unit">Unit</label>
                    <select id="velocity-unit" onchange="calculateEnergy()">
                        <option value="fps">Feet/sec (fps)</option>
                        <option value="mps">Metres/sec (m/s)</option>
                    </select>
                </div>
            </div>
            
            <div class="result-box single">
                <h3>Kinetic energy</h3>
                <div class="value" id="energy-ftlbf">2,611 ft·lbf</div>
                <div class="secondary" id="energy-joules">3,541 J</div>
            </div>
            
            <div class="info-box tip">
                <h4>Using this with TOP Gun Precision</h4>
                <p>
                    The kinetic energy calculated here can be used directly as the "Bullet kinetic energy" input 
                    in the <strong>TOP Gun Precision</strong> tab to estimate your rifle system's baseline precision.
                </p>
            </div>
            
            <div class="formula">
                Formula: E = (m × v²) / 450,437 where m is in grains and v is in fps
            </div>
            
            <!-- Typical Bullet Weights -->
            <div class="collapsible">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <span>Typical bullet weights by calibre</span>
                    <span class="arrow">▼</span>
                </div>
                <div class="collapsible-content">
                    <table class="ref-table">
                        <thead>
                            <tr>
                                <th>Calibre</th>
                                <th>Common weight(s)</th>
                                <th>Weight range</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="section-header">
                                <td colspan="3">Pistol</td>
                            </tr>
                            <tr>
                                <td>.22 LR</td>
                                <td>40 gr</td>
                                <td>30–40 gr</td>
                            </tr>
                            <tr>
                                <td>9mm Luger</td>
                                <td>115 gr, 124 gr</td>
                                <td>90–147+ gr</td>
                            </tr>
                            <tr>
                                <td>.40 S&W</td>
                                <td>165 gr, 180 gr</td>
                                <td>105–200 gr</td>
                            </tr>
                            <tr>
                                <td>.45 ACP</td>
                                <td>230 gr</td>
                                <td>68–300 gr</td>
                            </tr>
                            <tr class="section-header">
                                <td colspan="3">Rifle</td>
                            </tr>
                            <tr>
                                <td>.223 Rem / 5.56mm</td>
                                <td>55 gr, 62 gr</td>
                                <td>40–80+ gr</td>
                            </tr>
                            <tr>
                                <td>6.5 Creedmoor</td>
                                <td>140–150 gr</td>
                                <td>95–150 gr</td>
                            </tr>
                            <tr>
                                <td>.308 Win</td>
                                <td>150 gr, 165 gr, 180 gr</td>
                                <td>100–240 gr</td>
                            </tr>
                            <tr>
                                <td>.30-06 Sprg</td>
                                <td>150 gr, 165 gr, 180 gr</td>
                                <td>110–220 gr</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Typical Muzzle Velocities -->
            <div class="collapsible">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <span>Typical muzzle velocities by calibre</span>
                    <span class="arrow">▼</span>
                </div>
                <div class="collapsible-content">
                    <table class="ref-table">
                        <thead>
                            <tr>
                                <th>Calibre</th>
                                <th>Velocity (fps)</th>
                                <th>Velocity (m/s)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="section-header">
                                <td colspan="3">Pistol</td>
                            </tr>
                            <tr>
                                <td>.380 ACP</td>
                                <td>900–1,800 fps</td>
                                <td>~275–550 m/s</td>
                            </tr>
                            <tr>
                                <td>9mm</td>
                                <td>900–1,500 fps</td>
                                <td>~275–457 m/s</td>
                            </tr>
                            <tr>
                                <td>.45 ACP</td>
                                <td>750–1,300 fps</td>
                                <td>~230–396 m/s</td>
                            </tr>
                            <tr class="section-header">
                                <td colspan="3">Rifle</td>
                            </tr>
                            <tr>
                                <td>.22 LR</td>
                                <td>1,200–1,800 fps</td>
                                <td>~366–550 m/s</td>
                            </tr>
                            <tr>
                                <td>.223 / 5.56</td>
                                <td>2,500–4,000 fps</td>
                                <td>~762–1,219 m/s</td>
                            </tr>
                            <tr>
                                <td>6.5 Creedmoor</td>
                                <td>2,500–3,000 fps</td>
                                <td>~762–914 m/s</td>
                            </tr>
                            <tr>
                                <td>.308 Win</td>
                                <td>2,500–3,500 fps</td>
                                <td>~762–1,067 m/s</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- TOP Gun Precision Tab -->
    <div id="topgun-tab" class="tab-content">
        
        <div class="converter-section">
            <h2>TOP Gun precision calculator</h2>
            
            <div class="input-group">
                <div class="input-field">
                    <label for="bullet-energy">Bullet kinetic energy</label>
                    <input type="number" id="bullet-energy" step="any" value="2400" oninput="calculateTOPGun()">
                </div>
                <div class="input-field narrow">
                    <label for="energy-unit">Unit</label>
                    <select id="energy-unit" onchange="calculateTOPGun()">
                        <option value="ftlbf">ft·lbf</option>
                        <option value="joules">Joules</option>
                    </select>
                </div>
                <div class="input-field">
                    <label for="rifle-weight">Rifle weight</label>
                    <input type="number" id="rifle-weight" step="any" value="10" oninput="calculateTOPGun()">
                </div>
                <div class="input-field narrow">
                    <label for="rifle-weight-unit">Unit</label>
                    <select id="rifle-weight-unit" onchange="calculateTOPGun()">
                        <option value="lbs">Pounds (lbs)</option>
                        <option value="kg">Kilograms (kg)</option>
                    </select>
                </div>
            </div>
            
            <div class="result-grid">
                <div class="result-box">
                    <h3>Precision (avg 5-shot extreme spread)</h3>
                    <div class="value" id="precision-moa">1.200 MOA</div>
                    <div class="secondary" id="precision-mil">0.349 MIL</div>
                </div>
                <div class="result-box">
                    <h3>Mean radius</h3>
                    <div class="value" id="mean-radius-in">0.514 inches</div>
                    <div class="secondary" id="mean-radius-mm">13.05 mm</div>
                </div>
            </div>
            
            <div class="info-box">
                <h4>About this calculation</h4>
                <p>
                    <strong>Precision (MOA)</strong> is calculated using the Applied Ballistics "TOP Gun" formula: 
                    <em>Bullet Energy (ft·lbf) ÷ 200 ÷ Rifle Weight (lbs)</em>. 
                    This estimates the average 5-shot extreme spread at 100 yards for a given rifle system. [2]
                </p>
                <p style="margin-top: 10px;">
                    <strong>Mean radius</strong> represents the average distance of each shot from the centre of the group. 
                    Unlike extreme spread (which only measures the two worst shots), mean radius accounts for every shot 
                    in the group, making it more statistically meaningful—especially for smaller sample sizes. [2]
                    The conversion uses a coefficient of 0.428 derived from simulation of approximately 1 million 5-shot groups. [2]
                </p>
                <p style="margin-top: 10px;">
                    <a href="https://www.reddit.com/r/longrange/comments/1nfq1ms/top_gun_modified_to_output_mean_radius_and_back/" target="_blank">See this Reddit post for further details on the mean radius derivation →</a>
                </p>
            </div>
            
            <!-- Typical Energy Values -->
            <div class="collapsible">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <span>Typical bullet kinetic energy values</span>
                    <span class="arrow">▼</span>
                </div>
                <div class="collapsible-content">
                    <table class="ref-table">
                        <thead>
                            <tr>
                                <th>Cartridge</th>
                                <th>Muzzle energy (Joules)</th>
                                <th>Muzzle energy (ft·lbf)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>9mm Parabellum</td>
                                <td>~480 – 700 J</td>
                                <td>~350 – 500 ft·lbf</td>
                            </tr>
                            <tr>
                                <td>5.56 NATO (rifle)</td>
                                <td>~1,700 – 1,800 J</td>
                                <td>~1,250 – 1,330 ft·lbf</td>
                            </tr>
                            <tr>
                                <td>.308 Winchester (rifle)</td>
                                <td>~3,300 J</td>
                                <td>~2,400 ft·lbf</td>
                            </tr>
                            <tr>
                                <td>.30-06 Springfield (rifle)</td>
                                <td>~3,000 – 4,000 J</td>
                                <td>~2,000 – 3,000 ft·lbf</td>
                            </tr>
                            <tr>
                                <td>.50 BMG (anti-materiel)</td>
                                <td>~14,000 – 20,000 J</td>
                                <td>~10,000 – 15,000 ft·lbf</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Typical Rifle Weights -->
            <div class="collapsible">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <span>Typical rifle weight ranges</span>
                    <span class="arrow">▼</span>
                </div>
                <div class="collapsible-content">
                    <table class="ref-table">
                        <thead>
                            <tr>
                                <th>Application</th>
                                <th>Weight range (lbs)</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Lightweight/Backcountry hunting</td>
                                <td>5 – 8 lbs</td>
                                <td>Prioritises portability over long distances</td>
                            </tr>
                            <tr>
                                <td>General hunting</td>
                                <td>6 – 12 lbs</td>
                                <td>Balance between portability and stability</td>
                            </tr>
                            <tr>
                                <td>Tactical/Defence (M4, AR-15)</td>
                                <td>6.5 – 10 lbs</td>
                                <td>Robustness, reliability, manoeuvrability</td>
                            </tr>
                            <tr>
                                <td>Varmint shooting</td>
                                <td>7 – 10 lbs</td>
                                <td>Compromise for long-range precision</td>
                            </tr>
                            <tr>
                                <td>Target/Competition (PRS, Benchrest)</td>
                                <td>10 – 25+ lbs</td>
                                <td>Maximises stability, minimises recoil</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Sample Size Tab -->
    <div id="samplesize-tab" class="tab-content">

        <div class="converter-section">
            <h2>Minimum sample size calculator</h2>
            <p style="margin-top: 0; color: #666; font-size: 0.9rem;">
                Calculate the minimum number of shots per group to statistically determine a difference between two loads with >95% confidence.
            </p>

            <div class="input-group">
                <div class="input-field">
                    <label for="load1-radius">Load #1 mean radius</label>
                    <input type="number" id="load1-radius" step="0.001" value="0.200" min="0.001" oninput="calculateSampleSize()">
                </div>
                <div class="input-field">
                    <label for="load2-radius">Load #2 mean radius</label>
                    <input type="number" id="load2-radius" step="0.001" value="0.300" min="0.001" oninput="calculateSampleSize()">
                </div>
                <div class="input-field narrow">
                    <label for="radius-unit">Unit</label>
                    <select id="radius-unit" onchange="onRadiusUnitChange()">
                        <option value="inches">Inches</option>
                        <option value="mm">Millimetres</option>
                    </select>
                </div>
            </div>

            <div class="result-box single" id="sample-size-result">
                <h3>Minimum shots per group</h3>
                <div class="value" id="min-shots">22</div>
                <div class="secondary" id="sample-size-note">in EACH group to have >95% confidence the loads are different</div>
            </div>

            <div class="info-box">
                <h4>About this calculation</h4>
                <p>
                    This calculator is based on the work of <strong>Chris Hague at Hague & Sons Precision Gunsmithing</strong>.
                    It determines the minimum sample size needed to statistically differentiate between two loads
                    at a 95% confidence level.
                </p>
                <p style="margin-top: 10px;">
                    The formula used is:
                </p>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 4px; margin: 10px 0; text-align: center; font-family: 'Times New Roman', serif; font-size: 1.2rem;">
                    <em>n</em><sub>min</sub> = ⌈(0.730 × (R<sub>2</sub> + R<sub>1</sub>) / (R<sub>2</sub> − R<sub>1</sub>))<sup>2</sup>⌉ , <em>n</em><sub>min</sub> ≥ 10
                </div>
                <p style="margin-top: 10px;">
                    Where R<sub>1</sub> and R<sub>2</sub> are the mean radii of Load #1 and Load #2 respectively, and the result
                    is rounded up (ceiling function). A minimum of 10 shots is always required regardless of the calculation.
                </p>
                <p style="margin-top: 10px;">
                    <strong>Interpretation:</strong> If the loads truly differ by the amounts you entered, shooting this many rounds
                    per group gives you at least 95% confidence that any observed difference is real, not random chance.
                </p>
            </div>

            <!-- Reference table -->
            <div class="collapsible">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <span>Full reference table</span>
                    <span class="arrow">▼</span>
                </div>
                <div class="collapsible-content">
                    <p style="font-size: 0.85rem; color: #666; margin-bottom: 10px;">
                        Minimum number of shots in EACH group to have >95% confidence the loads are different
                    </p>
                    <div style="overflow-x: auto;">
                        <table class="sample-size-table" id="sample-size-table">
                            <!-- Table generated by JavaScript -->
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Extreme Spread Analysis Tab -->
    <div id="esanalysis-tab" class="tab-content">

        <div class="converter-section">
            <h2>Extreme spread to mean radius analysis</h2>
            <p style="margin-top: 0; color: #666; font-size: 0.9rem;">
                Convert your observed extreme spread (ES) to an estimated mean radius (MR) distribution based on Monte Carlo simulation of 1,000,000 shot groups.
            </p>

            <div class="warning-box" id="es-warning">
                The lookup table covers ES values from 0.1 to 2.0 MOA. Values outside this range cannot be calculated.
            </div>

            <div class="input-group">
                <div class="input-field">
                    <label for="es-value">Observed extreme spread</label>
                    <input type="number" id="es-value" step="any" value="1" min="0" oninput="calculateEStoMR()">
                </div>
                <div class="input-field narrow">
                    <label for="es-unit">Unit</label>
                    <select id="es-unit" onchange="onESUnitChange()">
                        <option value="moa">MOA</option>
                        <option value="mil">MIL (mrad)</option>
                        <option value="inches">Inches</option>
                        <option value="mm">Millimetres</option>
                    </select>
                </div>
                <div class="input-field distance-group" id="es-distance-group">
                    <label for="es-distance">Distance</label>
                    <input type="number" id="es-distance" step="any" value="100" min="1" oninput="calculateEStoMR()">
                </div>
                <div class="input-field narrow distance-group" id="es-distance-unit-group">
                    <label for="es-distance-unit">Distance unit</label>
                    <select id="es-distance-unit" onchange="calculateEStoMR()">
                        <option value="yards">Yards</option>
                        <option value="metres">Metres</option>
                    </select>
                </div>
                <div class="input-field narrow">
                    <label for="es-shots">Shots in group</label>
                    <select id="es-shots" onchange="calculateEStoMR()">
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5" selected>5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                        <option value="15">15</option>
                        <option value="16">16</option>
                        <option value="17">17</option>
                        <option value="18">18</option>
                        <option value="19">19</option>
                        <option value="20">20</option>
                        <option value="21">21</option>
                        <option value="22">22</option>
                        <option value="23">23</option>
                        <option value="24">24</option>
                        <option value="25">25</option>
                    </select>
                </div>
            </div>

            <!-- Bell Curve Visualization -->
            <div class="bell-curve-container">
                <svg class="bell-curve-svg" viewBox="0 0 400 180" id="bell-curve-svg">
                    <!-- Bell curve path -->
                    <defs>
                        <linearGradient id="bellGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#e8f4e8;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#d4edda;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <!-- Axes -->
                    <line x1="40" y1="140" x2="360" y2="140" stroke="#ccc" stroke-width="1"/>
                    <!-- Bell curve filled -->
                    <path id="bell-curve-path" fill="url(#bellGradient)" stroke="#28a745" stroke-width="2"/>
                    <!-- Percentile markers -->
                    <line id="marker-p5" x1="100" y1="20" x2="100" y2="140" stroke="#28a745" stroke-width="2" stroke-dasharray="4,2"/>
                    <line id="marker-p50" x1="200" y1="20" x2="200" y2="140" stroke="#007bff" stroke-width="2"/>
                    <line id="marker-p95" x1="300" y1="20" x2="300" y2="140" stroke="#dc3545" stroke-width="2" stroke-dasharray="4,2"/>
                    <!-- Labels on curve -->
                    <text id="label-p5" x="100" y="155" text-anchor="middle" font-size="11" fill="#28a745">5%</text>
                    <text id="label-p50" x="200" y="155" text-anchor="middle" font-size="11" fill="#007bff">50%</text>
                    <text id="label-p95" x="300" y="155" text-anchor="middle" font-size="11" fill="#dc3545">95%</text>
                    <!-- Axis label -->
                    <text x="200" y="175" text-anchor="middle" font-size="11" fill="#666">Mean Radius (MOA)</text>
                </svg>
                <div class="bell-curve-labels">
                    <div class="bell-curve-label p5">
                        <div class="percentile">5th percentile (optimistic)</div>
                        <div class="value" id="mr-p5-value">0.291 MOA</div>
                    </div>
                    <div class="bell-curve-label p50">
                        <div class="percentile">50th percentile (typical)</div>
                        <div class="value" id="mr-p50-value">0.369 MOA</div>
                    </div>
                    <div class="bell-curve-label p95">
                        <div class="percentile">95th percentile (conservative)</div>
                        <div class="value" id="mr-p95-value">0.451 MOA</div>
                    </div>
                </div>
            </div>

            <!-- Result boxes with converted units -->
            <div class="result-grid" id="es-mr-results">
                <div class="result-box">
                    <h3>Typical mean radius (50th percentile)</h3>
                    <div class="value" id="mr-typical-moa">0.369 MOA</div>
                    <div class="secondary" id="mr-typical-secondary">0.107 MIL / 0.387 in @ 100 yd</div>
                </div>
                <div class="result-box">
                    <h3>Range (5th to 95th percentile)</h3>
                    <div class="value" id="mr-range">0.291 – 0.451 MOA</div>
                    <div class="secondary" id="mr-range-secondary">0.305 – 0.472 in @ 100 yd</div>
                </div>
            </div>

            <!-- BPC Comparison Section -->
            <div class="bpc-section">
                <h3>Ballistic Precision Classification (BPC) Comparison</h3>
                <p style="margin: 0 0 15px 0; color: #666; font-size: 0.9rem;">
                    Compare your rifle's precision against standard BPC classes. Based on your observed extreme spread,
                    we estimate the underlying sigma (σ) and compare it to each class threshold.
                </p>
                <table class="bpc-table" id="bpc-table">
                    <thead>
                        <tr>
                            <th>BPC Class</th>
                            <th>Sigma (σ)</th>
                            <th>Median 5-shot Group Spread</th>
                            <th>Typical Examples</th>
                            <th>Your Results</th>
                        </tr>
                    </thead>
                    <tbody id="bpc-table-body">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
                <div class="info-box" style="margin-top: 0;">
                    <h4>About BPC</h4>
                    <p>
                        <strong>Ballistic Precision Classification (BPC)</strong> is a standardised system for describing rifle precision.
                        It uses sigma (σ), the statistical parameter of the Rayleigh distribution, to characterise accuracy.
                        Lower BPC classes indicate better precision.
                    </p>
                    <p style="margin-top: 10px;">
                        <strong>Your Results</strong> interpretation:
                    </p>
                    <ul style="margin: 5px 0 0 20px; padding: 0;">
                        <li><strong style="color: #155724;">Yes:</strong> Your rifle is more accurate than this class (95% confidence)</li>
                        <li><strong style="color: #856404;">Plausible:</strong> Your results are consistent with this class</li>
                        <li><strong style="color: #721c24;">No:</strong> Your rifle is less accurate than this class (95% confidence)</li>
                    </ul>
                    <p style="margin-top: 10px;">
                        <a href="http://ballistipedia.com/index.php?title=Ballistic_Precision_Classification" target="_blank">Learn more about BPC on Ballistipedia →</a>
                    </p>
                </div>
            </div>

            <div class="info-box">
                <h4>About this calculation</h4>
                <p>
                    <strong>Extreme Spread (ES)</strong> measures the maximum distance between any two shots in a group.
                    <strong>Mean Radius (MR)</strong> measures the average distance of each shot from the group centre.
                </p>
                <p style="margin-top: 10px;">
                    Because ES only considers the two most extreme shots, it's highly variable—especially with small sample sizes.
                    Mean radius accounts for every shot, making it more statistically stable and meaningful for comparing precision.
                </p>
                <p style="margin-top: 10px;">
                    This calculator uses Monte Carlo simulation (1,000,000 groups per sample size) to estimate the distribution
                    of mean radius values you might observe for a given extreme spread. The percentiles represent:
                </p>
                <ul style="margin: 10px 0 0 20px; padding: 0;">
                    <li><strong>5th percentile:</strong> Optimistic estimate—only 5% of groups would have a smaller MR</li>
                    <li><strong>50th percentile:</strong> Typical/median estimate—half of groups would be better, half worse</li>
                    <li><strong>95th percentile:</strong> Conservative estimate—95% of groups would have a smaller MR</li>
                </ul>
                <p style="margin-top: 10px;">
                    <a href="http://ballistipedia.com/index.php?title=Precision_Models" target="_blank">Learn more about precision models on Ballistipedia →</a>
                </p>
            </div>

            <!-- Reference table -->
            <div class="collapsible">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <span>Full reference table</span>
                    <span class="arrow">▼</span>
                </div>
                <div class="collapsible-content">
                    <p style="font-size: 0.85rem; color: #666; margin-bottom: 10px;">
                        Mean radius values (MOA) for each extreme spread and shot count combination.
                    </p>
                    <div class="percentile-selector">
                        <label>
                            <input type="radio" name="es-percentile" value="0" onchange="generateEStoMRTable()">
                            5th percentile (optimistic)
                        </label>
                        <label>
                            <input type="radio" name="es-percentile" value="1" checked onchange="generateEStoMRTable()">
                            50th percentile (typical)
                        </label>
                        <label>
                            <input type="radio" name="es-percentile" value="2" onchange="generateEStoMRTable()">
                            95th percentile (conservative)
                        </label>
                    </div>
                    <div style="overflow-x: auto;">
                        <table class="es-mr-table" id="es-mr-table">
                            <!-- Table generated by JavaScript -->
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // Constants
        // ============================================
        const MOA_PER_MIL = 3.4377;
        const INCHES_PER_MOA_AT_100YD = 1.047;
        const INCHES_PER_MIL_AT_100YD = 3.6;
        const MM_PER_INCH = 25.4;
        const METRES_PER_YARD = 0.9144;
        const FTLBF_PER_JOULE = 0.737562;
        const JOULES_PER_FTLBF = 1.355818;
        const LBS_PER_KG = 2.20462;
        const GRAINS_PER_GRAM = 15.4324;
        const FPS_PER_MPS = 3.28084;
        const ENERGY_CONSTANT = 450436.686; // 2 * 7000 grains/lb * 32.174 ft/s²
        const MEAN_RADIUS_COEFFICIENT = 0.428;
        const TOP_GUN_CONSTANT = 200;

        // Extreme Spread to Mean Radius lookup table
        // Generated by Monte Carlo simulation (1,000,000 groups per sample size)
        // Structure: ES_TO_MR_TABLE[es_moa][n_shots] = [p5, p50, p95]
        // Reference: http://ballistipedia.com/index.php?title=Precision_Models
        const ES_TO_MR_TABLE = {
            "0.1": {"3": [0.0359, 0.0425, 0.0514], "4": [0.0314, 0.039, 0.0478], "5": [0.0291, 0.0369, 0.0451], "6": [0.0277, 0.0353, 0.0432], "7": [0.0267, 0.0341, 0.0416], "8": [0.0259, 0.0331, 0.0403], "9": [0.0253, 0.0323, 0.0393], "10": [0.0249, 0.0316, 0.0383], "11": [0.0244, 0.031, 0.0375], "12": [0.0241, 0.0304, 0.0368], "13": [0.0238, 0.03, 0.0362], "14": [0.0235, 0.0296, 0.0356], "15": [0.0233, 0.0292, 0.0351], "16": [0.0231, 0.0289, 0.0347], "17": [0.0229, 0.0285, 0.0342], "18": [0.0227, 0.0283, 0.0338], "19": [0.0225, 0.028, 0.0335], "20": [0.0224, 0.0277, 0.0331], "21": [0.0222, 0.0275, 0.0328], "22": [0.0221, 0.0273, 0.0325], "23": [0.022, 0.0271, 0.0322], "24": [0.0218, 0.0269, 0.032], "25": [0.0217, 0.0267, 0.0317]},
            "0.2": {"3": [0.0718, 0.0849, 0.1029], "4": [0.0629, 0.078, 0.0957], "5": [0.0582, 0.0738, 0.0902], "6": [0.0553, 0.0707, 0.0863], "7": [0.0533, 0.0681, 0.0832], "8": [0.0519, 0.0662, 0.0806], "9": [0.0507, 0.0645, 0.0785], "10": [0.0497, 0.0631, 0.0767], "11": [0.0489, 0.0619, 0.075], "12": [0.0482, 0.0609, 0.0737], "13": [0.0476, 0.06, 0.0724], "14": [0.0471, 0.0591, 0.0713], "15": [0.0466, 0.0584, 0.0702], "16": [0.0461, 0.0577, 0.0693], "17": [0.0457, 0.0571, 0.0685], "18": [0.0454, 0.0565, 0.0677], "19": [0.045, 0.056, 0.0669], "20": [0.0447, 0.0555, 0.0663], "21": [0.0444, 0.055, 0.0657], "22": [0.0442, 0.0546, 0.065], "23": [0.0439, 0.0542, 0.0645], "24": [0.0437, 0.0538, 0.064], "25": [0.0435, 0.0535, 0.0635]},
            "0.3": {"3": [0.1076, 0.1274, 0.1543], "4": [0.0943, 0.117, 0.1435], "5": [0.0873, 0.1108, 0.1353], "6": [0.083, 0.106, 0.1295], "7": [0.08, 0.1022, 0.1248], "8": [0.0778, 0.0993, 0.1209], "9": [0.076, 0.0968, 0.1178], "10": [0.0746, 0.0947, 0.115], "11": [0.0733, 0.0929, 0.1125], "12": [0.0723, 0.0913, 0.1105], "13": [0.0714, 0.09, 0.1086], "14": [0.0706, 0.0887, 0.1069], "15": [0.0699, 0.0875, 0.1054], "16": [0.0692, 0.0866, 0.104], "17": [0.0686, 0.0856, 0.1027], "18": [0.068, 0.0848, 0.1015], "19": [0.0676, 0.084, 0.1004], "20": [0.0671, 0.0832, 0.0994], "21": [0.0667, 0.0826, 0.0985], "22": [0.0663, 0.0819, 0.0976], "23": [0.0659, 0.0813, 0.0967], "24": [0.0655, 0.0808, 0.0959], "25": [0.0652, 0.0802, 0.0952]},
            "0.4": {"3": [0.1435, 0.1699, 0.2058], "4": [0.1257, 0.156, 0.1913], "5": [0.1164, 0.1477, 0.1804], "6": [0.1107, 0.1413, 0.1727], "7": [0.1066, 0.1363, 0.1664], "8": [0.1037, 0.1323, 0.1613], "9": [0.1013, 0.1291, 0.1571], "10": [0.0994, 0.1263, 0.1533], "11": [0.0978, 0.1239, 0.1501], "12": [0.0964, 0.1218, 0.1473], "13": [0.0952, 0.1199, 0.1448], "14": [0.0941, 0.1183, 0.1425], "15": [0.0931, 0.1167, 0.1405], "16": [0.0923, 0.1154, 0.1387], "17": [0.0915, 0.1142, 0.1369], "18": [0.0907, 0.113, 0.1353], "19": [0.0901, 0.112, 0.1339], "20": [0.0894, 0.111, 0.1326], "21": [0.0889, 0.1101, 0.1313], "22": [0.0884, 0.1092, 0.1301], "23": [0.0878, 0.1084, 0.129], "24": [0.0874, 0.1077, 0.1279], "25": [0.087, 0.107, 0.127]},
            "0.5": {"3": [0.1794, 0.2123, 0.2572], "4": [0.1571, 0.195, 0.2391], "5": [0.1455, 0.1846, 0.2255], "6": [0.1383, 0.1767, 0.2158], "7": [0.1333, 0.1704, 0.2081], "8": [0.1297, 0.1654, 0.2016], "9": [0.1267, 0.1613, 0.1963], "10": [0.1243, 0.1579, 0.1917], "11": [0.1222, 0.1549, 0.1876], "12": [0.1205, 0.1522, 0.1841], "13": [0.119, 0.1499, 0.181], "14": [0.1176, 0.1478, 0.1781], "15": [0.1164, 0.1459, 0.1756], "16": [0.1154, 0.1443, 0.1733], "17": [0.1143, 0.1427, 0.1712], "18": [0.1134, 0.1413, 0.1692], "19": [0.1126, 0.1399, 0.1674], "20": [0.1118, 0.1387, 0.1657], "21": [0.1111, 0.1376, 0.1641], "22": [0.1104, 0.1366, 0.1626], "23": [0.1098, 0.1355, 0.1612], "24": [0.1092, 0.1346, 0.1599], "25": [0.1087, 0.1337, 0.1587]},
            "0.6": {"3": [0.2153, 0.2548, 0.3087], "4": [0.1886, 0.2341, 0.287], "5": [0.1746, 0.2215, 0.2706], "6": [0.166, 0.212, 0.259], "7": [0.16, 0.2044, 0.2497], "8": [0.1556, 0.1985, 0.2419], "9": [0.152, 0.1936, 0.2356], "10": [0.1492, 0.1894, 0.23], "11": [0.1467, 0.1858, 0.2251], "12": [0.1446, 0.1827, 0.221], "13": [0.1428, 0.1799, 0.2172], "14": [0.1412, 0.1774, 0.2138], "15": [0.1397, 0.1751, 0.2107], "16": [0.1384, 0.1731, 0.208], "17": [0.1372, 0.1713, 0.2054], "18": [0.1361, 0.1695, 0.203], "19": [0.1351, 0.1679, 0.2008], "20": [0.1341, 0.1665, 0.1988], "21": [0.1333, 0.1651, 0.197], "22": [0.1325, 0.1639, 0.1951], "23": [0.1317, 0.1626, 0.1934], "24": [0.1311, 0.1615, 0.1919], "25": [0.1304, 0.1605, 0.1905]},
            "0.7": {"3": [0.2512, 0.2973, 0.3601], "4": [0.22, 0.2731, 0.3348], "5": [0.2037, 0.2585, 0.3157], "6": [0.1936, 0.2473, 0.3022], "7": [0.1866, 0.2385, 0.2913], "8": [0.1815, 0.2316, 0.2822], "9": [0.1773, 0.2259, 0.2748], "10": [0.174, 0.221, 0.2684], "11": [0.1711, 0.2168, 0.2626], "12": [0.1687, 0.2131, 0.2578], "13": [0.1665, 0.2099, 0.2534], "14": [0.1647, 0.207, 0.2494], "15": [0.163, 0.2043, 0.2458], "16": [0.1615, 0.202, 0.2427], "17": [0.1601, 0.1998, 0.2396], "18": [0.1587, 0.1978, 0.2369], "19": [0.1576, 0.1959, 0.2343], "20": [0.1565, 0.1942, 0.232], "21": [0.1555, 0.1926, 0.2298], "22": [0.1546, 0.1912, 0.2276], "23": [0.1537, 0.1898, 0.2257], "24": [0.1529, 0.1885, 0.2239], "25": [0.1522, 0.1872, 0.2222]},
            "0.8": {"3": [0.2871, 0.3397, 0.4116], "4": [0.2514, 0.3121, 0.3826], "5": [0.2328, 0.2954, 0.3608], "6": [0.2213, 0.2827, 0.3453], "7": [0.2133, 0.2726, 0.3329], "8": [0.2075, 0.2647, 0.3225], "9": [0.2027, 0.2581, 0.3141], "10": [0.1989, 0.2526, 0.3067], "11": [0.1956, 0.2478, 0.3001], "12": [0.1928, 0.2436, 0.2946], "13": [0.1903, 0.2399, 0.2896], "14": [0.1882, 0.2365, 0.285], "15": [0.1863, 0.2335, 0.2809], "16": [0.1846, 0.2308, 0.2773], "17": [0.1829, 0.2283, 0.2738], "18": [0.1814, 0.226, 0.2707], "19": [0.1801, 0.2239, 0.2678], "20": [0.1789, 0.222, 0.2651], "21": [0.1777, 0.2202, 0.2626], "22": [0.1767, 0.2185, 0.2602], "23": [0.1756, 0.2169, 0.2579], "24": [0.1748, 0.2154, 0.2559], "25": [0.1739, 0.214, 0.254]},
            "0.9": {"3": [0.3229, 0.3822, 0.463], "4": [0.2829, 0.3511, 0.4304], "5": [0.2619, 0.3323, 0.4059], "6": [0.249, 0.318, 0.3885], "7": [0.24, 0.3067, 0.3745], "8": [0.2334, 0.2978, 0.3628], "9": [0.228, 0.2904, 0.3534], "10": [0.2237, 0.2842, 0.345], "11": [0.22, 0.2787, 0.3376], "12": [0.2169, 0.274, 0.3315], "13": [0.2141, 0.2699, 0.3258], "14": [0.2117, 0.2661, 0.3206], "15": [0.2096, 0.2626, 0.3161], "16": [0.2076, 0.2597, 0.312], "17": [0.2058, 0.2569, 0.3081], "18": [0.2041, 0.2543, 0.3045], "19": [0.2027, 0.2519, 0.3013], "20": [0.2012, 0.2497, 0.2982], "21": [0.2, 0.2477, 0.2954], "22": [0.1988, 0.2458, 0.2927], "23": [0.1976, 0.244, 0.2902], "24": [0.1966, 0.2423, 0.2878], "25": [0.1957, 0.2407, 0.2857]},
            "1.0": {"3": [0.3588, 0.4247, 0.5144], "4": [0.3143, 0.3901, 0.4783], "5": [0.291, 0.3692, 0.451], "6": [0.2766, 0.3533, 0.4317], "7": [0.2666, 0.3407, 0.4161], "8": [0.2593, 0.3309, 0.4032], "9": [0.2533, 0.3226, 0.3926], "10": [0.2486, 0.3157, 0.3834], "11": [0.2445, 0.3097, 0.3752], "12": [0.241, 0.3045, 0.3683], "13": [0.2379, 0.2999, 0.362], "14": [0.2353, 0.2957, 0.3563], "15": [0.2329, 0.2918, 0.3512], "16": [0.2307, 0.2885, 0.3466], "17": [0.2287, 0.2854, 0.3423], "18": [0.2268, 0.2825, 0.3384], "19": [0.2252, 0.2799, 0.3347], "20": [0.2236, 0.2775, 0.3314], "21": [0.2222, 0.2752, 0.3283], "22": [0.2209, 0.2731, 0.3252], "23": [0.2195, 0.2711, 0.3224], "24": [0.2185, 0.2692, 0.3198], "25": [0.2174, 0.2675, 0.3175]},
            "1.1": {"3": [0.3947, 0.4671, 0.5659], "4": [0.3457, 0.4291, 0.5261], "5": [0.32, 0.4062, 0.4961], "6": [0.3043, 0.3886, 0.4748], "7": [0.2933, 0.3748, 0.4577], "8": [0.2853, 0.3639, 0.4435], "9": [0.2787, 0.3549, 0.4319], "10": [0.2735, 0.3473, 0.4217], "11": [0.2689, 0.3407, 0.4127], "12": [0.2651, 0.3349, 0.4051], "13": [0.2617, 0.3298, 0.3982], "14": [0.2588, 0.3252, 0.3919], "15": [0.2561, 0.321, 0.3863], "16": [0.2538, 0.3174, 0.3813], "17": [0.2515, 0.314, 0.3765], "18": [0.2494, 0.3108, 0.3722], "19": [0.2477, 0.3079, 0.3682], "20": [0.2459, 0.3052, 0.3645], "21": [0.2444, 0.3027, 0.3611], "22": [0.243, 0.3004, 0.3577], "23": [0.2415, 0.2982, 0.3546], "24": [0.2403, 0.2962, 0.3518], "25": [0.2391, 0.2942, 0.3492]},
            "1.2": {"3": [0.4306, 0.5096, 0.6173], "4": [0.3772, 0.4681, 0.5739], "5": [0.3491, 0.4431, 0.5412], "6": [0.332, 0.424, 0.518], "7": [0.3199, 0.4089, 0.4993], "8": [0.3112, 0.397, 0.4838], "9": [0.304, 0.3872, 0.4712], "10": [0.2983, 0.3789, 0.46], "11": [0.2934, 0.3716, 0.4502], "12": [0.2893, 0.3653, 0.4419], "13": [0.2855, 0.3598, 0.4344], "14": [0.2823, 0.3548, 0.4275], "15": [0.2794, 0.3502, 0.4214], "16": [0.2768, 0.3462, 0.416], "17": [0.2744, 0.3425, 0.4108], "18": [0.2721, 0.339, 0.406], "19": [0.2702, 0.3359, 0.4017], "20": [0.2683, 0.333, 0.3977], "21": [0.2666, 0.3303, 0.3939], "22": [0.2651, 0.3277, 0.3902], "23": [0.2635, 0.3253, 0.3869], "24": [0.2622, 0.3231, 0.3838], "25": [0.2609, 0.321, 0.381]},
            "1.3": {"3": [0.4665, 0.5521, 0.6688], "4": [0.4086, 0.5071, 0.6217], "5": [0.3782, 0.48, 0.5863], "6": [0.3596, 0.4593, 0.5612], "7": [0.3466, 0.443, 0.5409], "8": [0.3371, 0.4301, 0.5241], "9": [0.3293, 0.4194, 0.5104], "10": [0.3232, 0.4105, 0.4984], "11": [0.3178, 0.4026, 0.4877], "12": [0.3134, 0.3958, 0.4788], "13": [0.3093, 0.3898, 0.4706], "14": [0.3059, 0.3844, 0.4631], "15": [0.3027, 0.3794, 0.4565], "16": [0.2999, 0.3751, 0.4506], "17": [0.2973, 0.3711, 0.445], "18": [0.2948, 0.3673, 0.4399], "19": [0.2927, 0.3639, 0.4352], "20": [0.2906, 0.3607, 0.4308], "21": [0.2888, 0.3578, 0.4267], "22": [0.2872, 0.355, 0.4228], "23": [0.2854, 0.3524, 0.4191], "24": [0.284, 0.35, 0.4158], "25": [0.2826, 0.3477, 0.4127]},
            "1.4": {"3": [0.5023, 0.5945, 0.7202], "4": [0.44, 0.5461, 0.6696], "5": [0.4073, 0.5169, 0.6314], "6": [0.3873, 0.4946, 0.6043], "7": [0.3733, 0.477, 0.5825], "8": [0.3631, 0.4632, 0.5644], "9": [0.3547, 0.4517, 0.5497], "10": [0.3481, 0.442, 0.5367], "11": [0.3423, 0.4336, 0.5252], "12": [0.3375, 0.4262, 0.5156], "13": [0.3331, 0.4198, 0.5068], "14": [0.3294, 0.4139, 0.4988], "15": [0.326, 0.4086, 0.4916], "16": [0.323, 0.4039, 0.4853], "17": [0.3201, 0.3996, 0.4792], "18": [0.3175, 0.3955, 0.4737], "19": [0.3153, 0.3919, 0.4686], "20": [0.313, 0.3885, 0.4639], "21": [0.3111, 0.3853, 0.4596], "22": [0.3092, 0.3824, 0.4553], "23": [0.3074, 0.3795, 0.4513], "24": [0.3059, 0.3769, 0.4477], "25": [0.3043, 0.3745, 0.4444]},
            "1.5": {"3": [0.5382, 0.637, 0.7717], "4": [0.4714, 0.5851, 0.7174], "5": [0.4364, 0.5539, 0.6765], "6": [0.4149, 0.53, 0.6475], "7": [0.3999, 0.5111, 0.6242], "8": [0.389, 0.4963, 0.6047], "9": [0.38, 0.484, 0.5889], "10": [0.3729, 0.4736, 0.5751], "11": [0.3667, 0.4646, 0.5627], "12": [0.3616, 0.4567, 0.5524], "13": [0.3569, 0.4498, 0.543], "14": [0.3529, 0.4435, 0.5344], "15": [0.3493, 0.4377, 0.5268], "16": [0.3461, 0.4328, 0.52], "17": [0.343, 0.4281, 0.5135], "18": [0.3402, 0.4238, 0.5076], "19": [0.3378, 0.4198, 0.5021], "20": [0.3354, 0.4162, 0.4971], "21": [0.3333, 0.4128, 0.4924], "22": [0.3313, 0.4097, 0.4878], "23": [0.3293, 0.4066, 0.4836], "24": [0.3277, 0.4039, 0.4797], "25": [0.3261, 0.4012, 0.4762]},
            "1.6": {"3": [0.5741, 0.6795, 0.8231], "4": [0.5029, 0.6241, 0.7652], "5": [0.4655, 0.5908, 0.7216], "6": [0.4426, 0.5653, 0.6907], "7": [0.4266, 0.5452, 0.6658], "8": [0.4149, 0.5294, 0.6451], "9": [0.4053, 0.5162, 0.6282], "10": [0.3978, 0.5052, 0.6134], "11": [0.3912, 0.4955, 0.6002], "12": [0.3857, 0.4871, 0.5892], "13": [0.3807, 0.4798, 0.5792], "14": [0.3764, 0.4731, 0.57], "15": [0.3726, 0.4669, 0.5619], "16": [0.3691, 0.4616, 0.5546], "17": [0.3659, 0.4567, 0.5477], "18": [0.3628, 0.452, 0.5414], "19": [0.3603, 0.4478, 0.5356], "20": [0.3577, 0.444, 0.5302], "21": [0.3555, 0.4403, 0.5252], "22": [0.3534, 0.437, 0.5203], "23": [0.3513, 0.4337, 0.5158], "24": [0.3495, 0.4308, 0.5117], "25": [0.3478, 0.428, 0.5079]},
            "1.7": {"3": [0.61, 0.7219, 0.8746], "4": [0.5343, 0.6631, 0.813], "5": [0.4946, 0.6277, 0.7667], "6": [0.4703, 0.6006, 0.7338], "7": [0.4532, 0.5793, 0.7074], "8": [0.4409, 0.5625, 0.6854], "9": [0.4307, 0.5485, 0.6675], "10": [0.4226, 0.5368, 0.6517], "11": [0.4156, 0.5265, 0.6378], "12": [0.4098, 0.5176, 0.6261], "13": [0.4045, 0.5098, 0.6154], "14": [0.4, 0.5026, 0.6057], "15": [0.3959, 0.4961, 0.597], "16": [0.3922, 0.4905, 0.5893], "17": [0.3887, 0.4852, 0.5819], "18": [0.3855, 0.4803, 0.5752], "19": [0.3828, 0.4758, 0.5691], "20": [0.3801, 0.4717, 0.5634], "21": [0.3777, 0.4679, 0.558], "22": [0.3755, 0.4643, 0.5528], "23": [0.3732, 0.4608, 0.5481], "24": [0.3714, 0.4577, 0.5437], "25": [0.3696, 0.4547, 0.5397]},
            "1.8": {"3": [0.6459, 0.7644, 0.926], "4": [0.5657, 0.7022, 0.8609], "5": [0.5237, 0.6646, 0.8118], "6": [0.4979, 0.636, 0.777], "7": [0.4799, 0.6133, 0.749], "8": [0.4668, 0.5955, 0.7257], "9": [0.456, 0.5808, 0.7067], "10": [0.4475, 0.5683, 0.6901], "11": [0.4401, 0.5575, 0.6753], "12": [0.4339, 0.548, 0.6629], "13": [0.4283, 0.5397, 0.6516], "14": [0.4235, 0.5322, 0.6413], "15": [0.4192, 0.5253, 0.6321], "16": [0.4153, 0.5193, 0.624], "17": [0.4116, 0.5138, 0.6162], "18": [0.4082, 0.5085, 0.6091], "19": [0.4053, 0.5038, 0.6025], "20": [0.4024, 0.4994, 0.5965], "21": [0.3999, 0.4954, 0.5909], "22": [0.3976, 0.4916, 0.5854], "23": [0.3952, 0.4879, 0.5803], "24": [0.3932, 0.4846, 0.5757], "25": [0.3913, 0.4815, 0.5714]},
            "1.9": {"3": [0.6818, 0.8069, 0.9775], "4": [0.5972, 0.7412, 0.9087], "5": [0.5528, 0.7016, 0.8569], "6": [0.5256, 0.6713, 0.8202], "7": [0.5066, 0.6474, 0.7906], "8": [0.4927, 0.6286, 0.766], "9": [0.4813, 0.613, 0.746], "10": [0.4724, 0.5999, 0.7284], "11": [0.4645, 0.5884, 0.7128], "12": [0.458, 0.5785, 0.6997], "13": [0.4521, 0.5697, 0.6878], "14": [0.447, 0.5618, 0.6769], "15": [0.4424, 0.5545, 0.6672], "16": [0.4383, 0.5482, 0.6586], "17": [0.4345, 0.5423, 0.6504], "18": [0.4309, 0.5368, 0.6429], "19": [0.4279, 0.5318, 0.636], "20": [0.4248, 0.5272, 0.6296], "21": [0.4222, 0.5229, 0.6237], "22": [0.4197, 0.5189, 0.6179], "23": [0.4171, 0.5151, 0.6125], "24": [0.4151, 0.5115, 0.6077], "25": [0.413, 0.5082, 0.6032]},
            "2.0": {"3": [0.7176, 0.8493, 1.0289], "4": [0.6286, 0.7802, 0.9565], "5": [0.5819, 0.7385, 0.902], "6": [0.5533, 0.7066, 0.8633], "7": [0.5332, 0.6815, 0.8322], "8": [0.5187, 0.6617, 0.8063], "9": [0.5066, 0.6453, 0.7853], "10": [0.4972, 0.6315, 0.7667], "11": [0.489, 0.6194, 0.7503], "12": [0.4821, 0.6089, 0.7366], "13": [0.4758, 0.5997, 0.724], "14": [0.4705, 0.5913, 0.7125], "15": [0.4657, 0.5837, 0.7023], "16": [0.4614, 0.577, 0.6933], "17": [0.4573, 0.5709, 0.6846], "18": [0.4535, 0.565, 0.6767], "19": [0.4504, 0.5598, 0.6695], "20": [0.4471, 0.5549, 0.6628], "21": [0.4444, 0.5504, 0.6565], "22": [0.4418, 0.5462, 0.6504], "23": [0.4391, 0.5422, 0.6448], "24": [0.4369, 0.5385, 0.6396], "25": [0.4348, 0.5349, 0.6349]}
        };

        // Ballistic Precision Classification (BPC) data
        // Reference: http://ballistipedia.com/index.php?title=Ballistic_Precision_Classification
        // MR to sigma conversion: σ = MR / √(π/2) ≈ MR / 1.2533
        const MR_TO_SIGMA = 1 / Math.sqrt(Math.PI / 2); // ≈ 0.7979

        // BPC class definitions: [sigmaThreshold, median5ShotES, typicalExamples]
        const BPC_CLASSES = [
            { class: 1, sigma: 0.1, median5ES: 0.3, examples: 'Rail guns' },
            { class: 2, sigma: 0.2, median5ES: 0.6, examples: 'Benchrest guns' },
            { class: 3, sigma: 0.3, median5ES: 0.9, examples: 'Mil-spec for PSR' },
            { class: 4, sigma: 0.4, median5ES: 1.2, examples: 'Competitive auto-loaders' },
            { class: 5, sigma: 0.5, median5ES: 1.5, examples: 'Mil-spec for M110 and M24' },
            { class: 6, sigma: 0.6, median5ES: 1.8, examples: 'Mil-spec for infantry rifles' }
        ];

        // ============================================
        // Tab switching
        // ============================================
        function switchTab(tabName, btn) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(b => {
                b.classList.remove('active');
            });
            btn.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // ============================================
        // Collapsible sections
        // ============================================
        function toggleCollapsible(header) {
            header.classList.toggle('open');
            const content = header.nextElementSibling;
            content.classList.toggle('open');
        }

        // ============================================
        // Number formatting
        // ============================================
        function formatNumber(num, decimals = 0) {
            return num.toLocaleString('en-AU', {
                minimumFractionDigits: decimals,
                maximumFractionDigits: decimals
            });
        }

        // ============================================
        // Conversions tab functions
        // ============================================
        function convertAngular() {
            const value = parseFloat(document.getElementById('angular-value').value) || 0;
            const from = document.getElementById('angular-from').value;
            const to = document.getElementById('angular-to').value;
            
            let result;
            let fromLabel = from.toUpperCase();
            let toLabel = to.toUpperCase();
            
            if (from === to) {
                result = value;
            } else if (from === 'moa' && to === 'mil') {
                result = value / MOA_PER_MIL;
            } else {
                result = value * MOA_PER_MIL;
            }
            
            document.getElementById('angular-result').innerHTML = 
                `${value} ${fromLabel} = <strong>${result.toFixed(4)} ${toLabel}</strong>`;
        }

        function swapAngular() {
            const from = document.getElementById('angular-from');
            const to = document.getElementById('angular-to');
            const temp = from.value;
            from.value = to.value;
            to.value = temp;
            convertAngular();
        }

        function convertAngularToLinear() {
            const value = parseFloat(document.getElementById('ang-lin-value').value) || 0;
            const unit = document.getElementById('ang-lin-unit').value;
            const distance = parseFloat(document.getElementById('ang-lin-distance').value) || 0;
            const distUnit = document.getElementById('ang-lin-dist-unit').value;
            
            // Convert distance to yards for calculation
            let distanceYards = distance;
            if (distUnit === 'metres') {
                distanceYards = distance / METRES_PER_YARD;
            }
            
            // Calculate inches
            let inches;
            if (unit === 'moa') {
                inches = value * INCHES_PER_MOA_AT_100YD * (distanceYards / 100);
            } else {
                inches = value * INCHES_PER_MIL_AT_100YD * (distanceYards / 100);
            }
            
            const mm = inches * MM_PER_INCH;
            const unitLabel = unit.toUpperCase();
            const distLabel = distUnit === 'yards' ? 'yards' : 'metres';
            
            document.getElementById('ang-lin-result').innerHTML = 
                `${value} ${unitLabel} at ${distance} ${distLabel} = <strong>${inches.toFixed(3)} inches</strong> / <strong>${mm.toFixed(2)} mm</strong>`;
        }

        function convertLinearToAngular() {
            const value = parseFloat(document.getElementById('lin-ang-value').value) || 0;
            const unit = document.getElementById('lin-ang-unit').value;
            const distance = parseFloat(document.getElementById('lin-ang-distance').value) || 0;
            const distUnit = document.getElementById('lin-ang-dist-unit').value;
            
            // Convert to inches if needed
            let inches = value;
            if (unit === 'mm') {
                inches = value / MM_PER_INCH;
            }
            
            // Convert distance to yards for calculation
            let distanceYards = distance;
            if (distUnit === 'metres') {
                distanceYards = distance / METRES_PER_YARD;
            }
            
            // Avoid division by zero
            if (distanceYards === 0) {
                document.getElementById('lin-ang-result').innerHTML = 'Enter a distance greater than zero';
                return;
            }
            
            // Calculate MOA and MIL
            const moa = inches / (INCHES_PER_MOA_AT_100YD * (distanceYards / 100));
            const mil = inches / (INCHES_PER_MIL_AT_100YD * (distanceYards / 100));
            
            const unitLabel = unit === 'inches' ? 'inch' : 'mm';
            const valueLabel = value === 1 ? unitLabel : (unit === 'inches' ? 'inches' : 'mm');
            const distLabel = distUnit === 'yards' ? 'yards' : 'metres';
            
            document.getElementById('lin-ang-result').innerHTML = 
                `${value} ${valueLabel} at ${distance} ${distLabel} = <strong>${moa.toFixed(3)} MOA</strong> / <strong>${mil.toFixed(3)} MIL</strong>`;
        }

        // ============================================
        // Bullet Kinetic Energy tab functions
        // ============================================
        function calculateEnergy() {
            let weight = parseFloat(document.getElementById('bullet-weight').value) || 0;
            const weightUnit = document.getElementById('weight-unit-energy').value;
            let velocity = parseFloat(document.getElementById('muzzle-velocity').value) || 0;
            const velocityUnit = document.getElementById('velocity-unit').value;
            
            // Convert weight to grains if in grams
            let weightGrains = weight;
            if (weightUnit === 'grams') {
                weightGrains = weight * GRAINS_PER_GRAM;
            }
            
            // Convert velocity to fps if in m/s
            let velocityFps = velocity;
            if (velocityUnit === 'mps') {
                velocityFps = velocity * FPS_PER_MPS;
            }
            
            // Calculate energy in ft·lbf: E = (m * v²) / 450,436.686
            const energyFtLbf = (weightGrains * velocityFps * velocityFps) / ENERGY_CONSTANT;
            const energyJoules = energyFtLbf * JOULES_PER_FTLBF;
            
            // Update display
            document.getElementById('energy-ftlbf').textContent = formatNumber(energyFtLbf, 0) + ' ft·lbf';
            document.getElementById('energy-joules').textContent = formatNumber(energyJoules, 0) + ' J';
        }

        // ============================================
        // TOP Gun tab functions
        // ============================================
        function calculateTOPGun() {
            let energy = parseFloat(document.getElementById('bullet-energy').value) || 0;
            const energyUnit = document.getElementById('energy-unit').value;
            let weight = parseFloat(document.getElementById('rifle-weight').value) || 0;
            const weightUnit = document.getElementById('rifle-weight-unit').value;
            
            // Convert energy to ft·lbf if in Joules
            let energyFtLbf = energy;
            if (energyUnit === 'joules') {
                energyFtLbf = energy * FTLBF_PER_JOULE;
            }
            
            // Convert weight to lbs if in kg
            let weightLbs = weight;
            if (weightUnit === 'kg') {
                weightLbs = weight * LBS_PER_KG;
            }
            
            // Avoid division by zero
            if (weightLbs === 0) {
                document.getElementById('precision-moa').textContent = '—';
                document.getElementById('precision-mil').textContent = '—';
                document.getElementById('mean-radius-in').textContent = '—';
                document.getElementById('mean-radius-mm').textContent = '—';
                return;
            }
            
            // Calculate precision (MOA) using TOP Gun formula
            const precisionMOA = energyFtLbf / TOP_GUN_CONSTANT / weightLbs;
            const precisionMIL = precisionMOA / MOA_PER_MIL;
            
            // Calculate mean radius
            const meanRadiusInches = precisionMOA * MEAN_RADIUS_COEFFICIENT;
            const meanRadiusMM = meanRadiusInches * MM_PER_INCH;
            
            // Update display
            document.getElementById('precision-moa').textContent = precisionMOA.toFixed(3) + ' MOA';
            document.getElementById('precision-mil').textContent = precisionMIL.toFixed(3) + ' MIL';
            document.getElementById('mean-radius-in').textContent = meanRadiusInches.toFixed(3) + ' inches';
            document.getElementById('mean-radius-mm').textContent = meanRadiusMM.toFixed(2) + ' mm';
        }

        // ============================================
        // Sample Size tab functions
        // ============================================

        // Base values in inches for the reference table
        const SAMPLE_SIZE_COL_VALUES_INCHES = [0.100, 0.125, 0.150, 0.175, 0.200, 0.225, 0.250, 0.275, 0.300, 0.325, 0.350, 0.375, 0.400, 0.425, 0.450, 0.475];
        const SAMPLE_SIZE_ROW_VALUES_INCHES = [0.125, 0.150, 0.175, 0.200, 0.225, 0.250, 0.275, 0.300, 0.325, 0.350, 0.375, 0.400, 0.425, 0.450, 0.475, 0.500];

        function calculateMinSampleSize(r1, r2) {
            // Ensure r2 > r1 for the formula
            const rSmall = Math.min(r1, r2);
            const rLarge = Math.max(r1, r2);

            if (rSmall === rLarge || rSmall <= 0 || rLarge <= 0) {
                return null; // Invalid or identical radii
            }

            const ratio = (rLarge + rSmall) / (rLarge - rSmall);
            const nMin = Math.ceil(Math.pow(0.730 * ratio, 2));

            // Minimum of 10 shots required
            return Math.max(nMin, 10);
        }

        function calculateSampleSize() {
            const r1 = parseFloat(document.getElementById('load1-radius').value) || 0;
            const r2 = parseFloat(document.getElementById('load2-radius').value) || 0;

            if (r1 <= 0 || r2 <= 0) {
                document.getElementById('min-shots').textContent = '—';
                document.getElementById('sample-size-note').textContent = 'Enter positive values for both radii';
                return;
            }

            if (r1 === r2) {
                document.getElementById('min-shots').textContent = '—';
                document.getElementById('sample-size-note').textContent = 'Radii must be different to compare loads';
                return;
            }

            // The formula is unit-agnostic (ratio-based), so no conversion needed
            document.getElementById('min-shots').textContent = calculateMinSampleSize(r1, r2);
            document.getElementById('sample-size-note').textContent = 'in EACH group to have >95% confidence the loads are different';
        }

        function onRadiusUnitChange() {
            const unit = document.getElementById('radius-unit').value;
            const r1Input = document.getElementById('load1-radius');
            const r2Input = document.getElementById('load2-radius');
            const r1 = parseFloat(r1Input.value) || 0;
            const r2 = parseFloat(r2Input.value) || 0;

            if (unit === 'mm') {
                // Convert inches to mm
                r1Input.value = (r1 * MM_PER_INCH).toFixed(2);
                r2Input.value = (r2 * MM_PER_INCH).toFixed(2);
                r1Input.step = '0.01';
                r2Input.step = '0.01';
            } else {
                // Convert mm to inches
                r1Input.value = (r1 / MM_PER_INCH).toFixed(3);
                r2Input.value = (r2 / MM_PER_INCH).toFixed(3);
                r1Input.step = '0.001';
                r2Input.step = '0.001';
            }

            // Regenerate the table with new unit
            generateSampleSizeTable();
            calculateSampleSize();
        }

        function generateSampleSizeTable() {
            const table = document.getElementById('sample-size-table');
            const unit = document.getElementById('radius-unit').value;
            const isMetric = unit === 'mm';

            // Convert base values if using mm
            const colValues = isMetric
                ? SAMPLE_SIZE_COL_VALUES_INCHES.map(v => v * MM_PER_INCH)
                : SAMPLE_SIZE_COL_VALUES_INCHES;
            const rowValues = isMetric
                ? SAMPLE_SIZE_ROW_VALUES_INCHES.map(v => v * MM_PER_INCH)
                : SAMPLE_SIZE_ROW_VALUES_INCHES;

            const decimals = isMetric ? 1 : 3;
            const unitLabel = isMetric ? 'mm' : 'in';

            let html = '<thead><tr>';
            html += `<th class="corner-header">#2 (${unitLabel}) \\ #1</th>`;
            for (const col of colValues) {
                html += `<th>${col.toFixed(decimals)}</th>`;
            }
            html += '</tr></thead><tbody>';

            for (let i = 0; i < rowValues.length; i++) {
                const row = rowValues[i];
                const rowInches = SAMPLE_SIZE_ROW_VALUES_INCHES[i];
                html += `<tr><td class="row-header">${row.toFixed(decimals)}</td>`;

                for (let j = 0; j < colValues.length; j++) {
                    const colInches = SAMPLE_SIZE_COL_VALUES_INCHES[j];
                    // Use inch values for comparison to avoid floating point issues
                    if (Math.abs(rowInches - colInches) < 0.0001) {
                        html += '<td class="diagonal">-</td>';
                    } else {
                        // Formula is ratio-based, so same result regardless of units
                        const nMin = calculateMinSampleSize(rowInches, colInches);
                        let cellClass = '';
                        if (nMin <= 20) {
                            cellClass = 'low';
                        } else if (nMin <= 100) {
                            cellClass = 'medium';
                        } else {
                            cellClass = 'high';
                        }
                        html += `<td class="${cellClass}">${nMin}</td>`;
                    }
                }
                html += '</tr>';
            }
            html += '</tbody>';

            table.innerHTML = html;
        }

        // ============================================
        // ES to MR Analysis tab functions
        // ============================================

        // Track previous ES unit for conversions
        let previousESUnit = 'moa';

        function onESUnitChange() {
            const unit = document.getElementById('es-unit').value;
            const distanceGroup = document.getElementById('es-distance-group');
            const distanceUnitGroup = document.getElementById('es-distance-unit-group');
            const esInput = document.getElementById('es-value');
            const esValue = parseFloat(esInput.value) || 0;

            // Show distance inputs only for linear units (inches, mm)
            if (unit === 'inches' || unit === 'mm') {
                distanceGroup.classList.add('visible');
                distanceUnitGroup.classList.add('visible');
            } else {
                distanceGroup.classList.remove('visible');
                distanceUnitGroup.classList.remove('visible');
            }

            // Convert value when switching between inches and mm
            if (previousESUnit === 'inches' && unit === 'mm') {
                esInput.value = (esValue * MM_PER_INCH).toFixed(2);
                esInput.step = '0.01';
            } else if (previousESUnit === 'mm' && unit === 'inches') {
                esInput.value = (esValue / MM_PER_INCH).toFixed(3);
                esInput.step = '0.001';
            } else if (unit === 'mm') {
                esInput.step = '0.01';
            } else if (unit === 'inches') {
                esInput.step = '0.001';
            } else {
                esInput.step = 'any';
            }

            previousESUnit = unit;
            calculateEStoMR();
        }

        function calculateEStoMR() {
            const esValue = parseFloat(document.getElementById('es-value').value) || 0;
            const esUnit = document.getElementById('es-unit').value;
            const nShots = document.getElementById('es-shots').value;
            const warning = document.getElementById('es-warning');

            // Convert ES to MOA
            let esMOA = esValue;

            if (esUnit === 'mil') {
                esMOA = esValue * MOA_PER_MIL;
            } else if (esUnit === 'inches' || esUnit === 'mm') {
                const distance = parseFloat(document.getElementById('es-distance').value) || 100;
                const distUnit = document.getElementById('es-distance-unit').value;

                // Convert to inches if mm
                let inches = esValue;
                if (esUnit === 'mm') {
                    inches = esValue / MM_PER_INCH;
                }

                // Convert distance to yards
                let distanceYards = distance;
                if (distUnit === 'metres') {
                    distanceYards = distance / METRES_PER_YARD;
                }

                // Convert to MOA
                if (distanceYards > 0) {
                    esMOA = inches / (INCHES_PER_MOA_AT_100YD * (distanceYards / 100));
                } else {
                    esMOA = 0;
                }
            }

            // Validate ES is in range
            if (esMOA < 0.1 || esMOA > 2.0 || esValue <= 0) {
                warning.classList.add('visible');
                document.getElementById('mr-p5-value').textContent = '—';
                document.getElementById('mr-p50-value').textContent = '—';
                document.getElementById('mr-p95-value').textContent = '—';
                document.getElementById('mr-typical-moa').textContent = '—';
                document.getElementById('mr-typical-secondary').textContent = '—';
                document.getElementById('mr-range').textContent = '—';
                document.getElementById('mr-range-secondary').textContent = '—';
                updateBPCTable(null, null, null);
                return;
            }

            warning.classList.remove('visible');

            // Round ES to nearest 0.1 for table lookup
            const esKey = (Math.round(esMOA * 10) / 10).toFixed(1);

            // Clamp to valid range
            const clampedKey = Math.max(0.1, Math.min(2.0, parseFloat(esKey))).toFixed(1);

            // Lookup MR values
            const mrValues = ES_TO_MR_TABLE[clampedKey]?.[nShots];

            if (!mrValues) {
                warning.classList.add('visible');
                document.getElementById('mr-p5-value').textContent = '—';
                document.getElementById('mr-p50-value').textContent = '—';
                document.getElementById('mr-p95-value').textContent = '—';
                document.getElementById('mr-typical-moa').textContent = '—';
                document.getElementById('mr-typical-secondary').textContent = '—';
                document.getElementById('mr-range').textContent = '—';
                document.getElementById('mr-range-secondary').textContent = '—';
                updateBPCTable(null, null, null);
                return;
            }

            const [mrP5, mrP50, mrP95] = mrValues;

            // Update bell curve labels
            document.getElementById('mr-p5-value').textContent = mrP5.toFixed(3) + ' MOA';
            document.getElementById('mr-p50-value').textContent = mrP50.toFixed(3) + ' MOA';
            document.getElementById('mr-p95-value').textContent = mrP95.toFixed(3) + ' MOA';

            // Update result boxes
            const mrP50MIL = mrP50 / MOA_PER_MIL;
            const mrP50Inches = mrP50 * INCHES_PER_MOA_AT_100YD;

            document.getElementById('mr-typical-moa').textContent = mrP50.toFixed(3) + ' MOA';
            document.getElementById('mr-typical-secondary').textContent =
                mrP50MIL.toFixed(3) + ' MIL / ' + mrP50Inches.toFixed(3) + ' in @ 100 yd';

            const mrP5Inches = mrP5 * INCHES_PER_MOA_AT_100YD;
            const mrP95Inches = mrP95 * INCHES_PER_MOA_AT_100YD;

            document.getElementById('mr-range').textContent =
                mrP5.toFixed(3) + ' – ' + mrP95.toFixed(3) + ' MOA';
            document.getElementById('mr-range-secondary').textContent =
                mrP5Inches.toFixed(3) + ' – ' + mrP95Inches.toFixed(3) + ' in @ 100 yd';

            // Update bell curve visualization
            updateBellCurve(mrP5, mrP50, mrP95);

            // Update BPC comparison table
            updateBPCTable(mrP5, mrP50, mrP95);
        }

        function updateBellCurve(p5, p50, p95) {
            // SVG dimensions
            const svgWidth = 400;
            const svgHeight = 180;
            const margin = { left: 40, right: 40, top: 20, bottom: 40 };
            const width = svgWidth - margin.left - margin.right;
            const height = svgHeight - margin.top - margin.bottom;

            // Calculate x positions for percentiles
            // Map the range [p5 - padding, p95 + padding] to [margin.left, svgWidth - margin.right]
            const padding = (p95 - p5) * 0.3;
            const minVal = p5 - padding;
            const maxVal = p95 + padding;
            const range = maxVal - minVal;

            function xScale(val) {
                return margin.left + ((val - minVal) / range) * width;
            }

            const xP5 = xScale(p5);
            const xP50 = xScale(p50);
            const xP95 = xScale(p95);

            // Update marker positions
            document.getElementById('marker-p5').setAttribute('x1', xP5);
            document.getElementById('marker-p5').setAttribute('x2', xP5);
            document.getElementById('marker-p50').setAttribute('x1', xP50);
            document.getElementById('marker-p50').setAttribute('x2', xP50);
            document.getElementById('marker-p95').setAttribute('x1', xP95);
            document.getElementById('marker-p95').setAttribute('x2', xP95);

            // Update label positions
            document.getElementById('label-p5').setAttribute('x', xP5);
            document.getElementById('label-p50').setAttribute('x', xP50);
            document.getElementById('label-p95').setAttribute('x', xP95);

            // Generate bell curve path
            // Approximate normal distribution centered at p50
            const sigma = (p95 - p5) / 3.29; // 90% of data between p5 and p95
            const mu = p50;

            function normalPDF(x) {
                const z = (x - mu) / sigma;
                return Math.exp(-0.5 * z * z) / (sigma * Math.sqrt(2 * Math.PI));
            }

            // Find max PDF for scaling
            const maxPDF = normalPDF(mu);

            // Generate path points
            const points = [];
            const steps = 100;
            for (let i = 0; i <= steps; i++) {
                const val = minVal + (range * i / steps);
                const x = xScale(val);
                const y = margin.top + height - (normalPDF(val) / maxPDF) * height * 0.9;
                points.push({ x, y });
            }

            // Create path data
            let pathD = `M ${margin.left} ${margin.top + height}`;
            points.forEach(p => {
                pathD += ` L ${p.x.toFixed(1)} ${p.y.toFixed(1)}`;
            });
            pathD += ` L ${svgWidth - margin.right} ${margin.top + height} Z`;

            document.getElementById('bell-curve-path').setAttribute('d', pathD);
        }

        function updateBPCTable(mrP5, mrP50, mrP95) {
            const tbody = document.getElementById('bpc-table-body');

            // If no valid data, show placeholder
            if (mrP5 === null || mrP50 === null || mrP95 === null) {
                let html = '';
                for (const bpc of BPC_CLASSES) {
                    html += `<tr>
                        <td>Class ${bpc.class}</td>
                        <td>&lt; ${bpc.sigma.toFixed(1)} MOA</td>
                        <td>${bpc.median5ES.toFixed(1)} MOA</td>
                        <td class="example-col">${bpc.examples}</td>
                        <td class="bpc-unknown">—</td>
                    </tr>`;
                }
                tbody.innerHTML = html;
                return;
            }

            // Convert MR to sigma estimates
            // σ = MR / √(π/2) ≈ MR * 0.7979
            const sigmaOptimistic = mrP5 * MR_TO_SIGMA;   // Lower bound (from p5 MR)
            const sigmaTypical = mrP50 * MR_TO_SIGMA;     // Typical estimate (from p50 MR)
            const sigmaConservative = mrP95 * MR_TO_SIGMA; // Upper bound (from p95 MR)

            // Calculate equivalent median 5-shot ES from sigma estimates
            // Median 5-shot ES ≈ 3 × σ
            const es5Optimistic = sigmaOptimistic * 3;
            const es5Typical = sigmaTypical * 3;
            const es5Conservative = sigmaConservative * 3;

            let html = '';
            for (const bpc of BPC_CLASSES) {
                // Determine comparison result
                // "Yes" (green): user's conservative sigma < class threshold (better than class with 95% confidence)
                // "No" (red): user's optimistic sigma >= class threshold (worse than class even with 5% confidence)
                // "Plausible" (yellow): user's results overlap with class threshold
                let resultClass, resultText;

                if (sigmaConservative < bpc.sigma) {
                    // Even worst-case estimate is better than this class
                    resultClass = 'bpc-yes';
                    resultText = 'Yes';
                } else if (sigmaOptimistic >= bpc.sigma) {
                    // Even best-case estimate is worse than this class
                    resultClass = 'bpc-no';
                    resultText = 'No';
                } else {
                    // Results overlap with class boundary
                    resultClass = 'bpc-plausible';
                    resultText = 'Plausible';
                }

                html += `<tr>
                    <td>Class ${bpc.class}</td>
                    <td>&lt; ${bpc.sigma.toFixed(1)} MOA</td>
                    <td>${bpc.median5ES.toFixed(1)} MOA</td>
                    <td class="example-col">${bpc.examples}</td>
                    <td class="${resultClass}">${resultText}</td>
                </tr>`;
            }

            tbody.innerHTML = html;
        }

        function generateEStoMRTable() {
            const table = document.getElementById('es-mr-table');
            const percentileIndex = parseInt(document.querySelector('input[name="es-percentile"]:checked').value);

            const esValues = ['0.1', '0.2', '0.3', '0.4', '0.5', '0.6', '0.7', '0.8', '0.9', '1.0',
                              '1.1', '1.2', '1.3', '1.4', '1.5', '1.6', '1.7', '1.8', '1.9', '2.0'];
            const shotCounts = ['3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15',
                                '16', '17', '18', '19', '20', '21', '22', '23', '24', '25'];

            let html = '<thead><tr>';
            html += '<th class="corner-header">ES (MOA) \\ Shots</th>';
            for (const n of shotCounts) {
                html += `<th>${n}</th>`;
            }
            html += '</tr></thead><tbody>';

            for (const es of esValues) {
                html += `<tr><td class="row-header">${es}</td>`;
                for (const n of shotCounts) {
                    const values = ES_TO_MR_TABLE[es]?.[n];
                    if (values) {
                        const mr = values[percentileIndex];
                        html += `<td>${mr.toFixed(3)}</td>`;
                    } else {
                        html += '<td>—</td>';
                    }
                }
                html += '</tr>';
            }
            html += '</tbody>';

            table.innerHTML = html;
        }

        // ============================================
        // Initialise on load
        // ============================================
        convertAngular();
        convertAngularToLinear();
        convertLinearToAngular();
        calculateEnergy();
        calculateTOPGun();
        calculateSampleSize();
        generateSampleSizeTable();
        calculateEStoMR();
        generateEStoMRTable();
    </script>
</body>
</html>